{"version":3,"sources":["webpack://vuex-persistent-plugin/webpack/universalModuleDefinition","webpack://vuex-persistent-plugin/webpack/bootstrap","webpack://vuex-persistent-plugin/./node_modules/immediate/lib/mutation.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/node-libs-browser/node_modules/buffer/index.js","webpack://vuex-persistent-plugin/./node_modules/base64-js/index.js","webpack://vuex-persistent-plugin/./node_modules/deep-extend/lib/deep-extend.js","webpack://vuex-persistent-plugin/./node_modules/inherits/inherits_browser.js","webpack://vuex-persistent-plugin/./node_modules/node-libs-browser/mock/process.js","webpack://vuex-persistent-plugin/./node_modules/immediate/lib/queueMicrotask.js","webpack://vuex-persistent-plugin/./node_modules/spark-md5/spark-md5.js","webpack://vuex-persistent-plugin/./node_modules/vuvuzela/index.js","webpack://vuex-persistent-plugin/./node_modules/immediate/lib/index.js","webpack://vuex-persistent-plugin/./node_modules/immediate/lib/stateChange.js","webpack://vuex-persistent-plugin/./node_modules/@soda/get-current-script/index.js","webpack://vuex-persistent-plugin/./node_modules/ieee754/index.js","webpack://vuex-persistent-plugin/(webpack)/buildin/global.js","webpack://vuex-persistent-plugin/./node_modules/immediate/lib/messageChannel.js","webpack://vuex-persistent-plugin/./node_modules/argsarray/index.js","webpack://vuex-persistent-plugin/./node_modules/path-browserify/index.js","webpack://vuex-persistent-plugin/./node_modules/immediate/lib/timeout.js","webpack://vuex-persistent-plugin/./node_modules/isarray/index.js","webpack://vuex-persistent-plugin/./node_modules/uuid/dist/esm-browser/rng.js","webpack://vuex-persistent-plugin/./node_modules/uuid/dist/esm-browser/bytesToUuid.js","webpack://vuex-persistent-plugin/./node_modules/uuid/dist/esm-browser/v4.js","webpack://vuex-persistent-plugin/./node_modules/events/events.js","webpack://vuex-persistent-plugin/./node_modules/@vue/cli-service/lib/commands/build/setPublicPath.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-errors/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-fetch/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-collections/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-binary-utils/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-collate/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-md5/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-utils/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-mapreduce-utils/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-abstract-mapreduce/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-selector-core/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-find/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./src/Storage.js","webpack://vuex-persistent-plugin/./src/persistent.js"],"names":["root","factory","exports","module","define","amd","self","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Mutation","global","MutationObserver","WebKitMutationObserver","test","install","handle","called","observer","element","document","createTextNode","observe","characterData","data","ExportedSet","ExportedMap","mangle","unmangle","substring","Map$1","_store","Set$1","array","Array","isArray","len","length","add","supportsMapAndSet","Map","Set","prop","getOwnPropertyDescriptor","species","isBinaryObject","ArrayBuffer","Blob","cloneArrayBuffer","buff","slice","target","byteLength","targetArray","Uint8Array","sourceArray","set","cloneBinaryObject","size","type","webkitSlice","mangled","has","delete","res","forEach","cb","keys","funcToString","Function","toString","objectCtorString","isPlainObject","proto","getPrototypeOf","Ctor","constructor","clone","newObject","Date","toISOString","once","fun","args","Error","apply","toPromise","func","usedCB","pop","promise","Promise","fulfill","reject","resp","callback","err","mesg","push","then","e","result","logApiCall","listeners","logArgs","emit","origCallback","responseArgs","concat","adapterFun","_closed","_destroyed","taskqueue","isReady","addTask","failed","pick","obj","arr","hasLocal","assign","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","x","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","request","id","numDocs","numDone","perDocResults","collapseResultsAndFinish","results","info","checkDone","gotResult","docIndex","allRequests","nextBatch","upTo","Math","min","batch","processBatch","offset","docId","j","docIdx","docRequests","docOpts","open_revs","map","rev","filter","formatResult","param","error","localStorage","setItem","getItem","hasLocalStorage","attachBrowserEvents","addEventListener","Changes","_listeners","guardedConsole","method","console","arguments","randomNumber","max","maxTimeout","parseInt","ratio","random","range","defaultBackOff","explainError","status","str","addListener","dbName","inprogress","eventFunction","on","changesOpts","changes","seq","since","cancelled","onChange","onError","removeListener","notifyLocalWindows","notify","to","index","nextSource","nextKey","$inject_Object_assign","PouchError","reason","message","JSON","stringify","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","UNKNOWN_ERROR","BAD_ARG","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","IDB_ERROR","INVALID_REV","MISSING_STUB","createError","CustomPouchError","names","getOwnPropertyNames","undefined","generateErrorFromResponse","tryFilter","doc","req","msg","filterChange","hasFilter","query","query_params","change","filterReturn","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","isRemote","_remote","listenerCount","ee","parseDesignDocFunctionName","parts","split","normalizeDesignDocFunctionName","normalized","join","qName","qParser","parser","parseUri","exec","uri","encoded","indexOf","decodeURIComponent","replace","$0","$1","$2","scopeEval","source","scope","values","upsert","diffFun","docRev","_rev","newDoc","updated","_id","tryAndPut","put","thisAtob","atob","thisBtoa","btoa","createBlob","properties","Builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","builder","append","getBlob","binaryStringToArrayBuffer","bin","buf","charCodeAt","binStringToBluffer","binString","b64ToBluffer","b64","arrayBufferToBinaryString","buffer","binary","bytes","String","fromCharCode","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","setImmediate","setTimeout","MD5_CHUNK_SIZE","rawToBase64","raw","sliceBlob","start","end","appendBlob","arrayBuffer","appendString","string","appendBinary","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","next","loadNextChunk","done","destroy","stringMd5","hash","deterministic_revs","clonedDoc","_rev_tree","toLowerCase","uuid","winningRev","metadata","winningId","winningPos","winningDeleted","node","toVisit","rev_tree","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","ctx","sortByPos","a","b","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","compactTree","revHash","rootToLeaf","paths","history","sortByPos$1","binarySearch","item","comparator","mid","low","high","insertSorted","idx","splice","pathToTree","path","numStemmed","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","queue","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parent","parentIdx","elements","elementsLen","el","stem","depth","stemmedRevs","stemmed","merge","newTree","revExists","splitRev","targetPos","targetId","getTrees","isDeleted","isLocalId","latest","historyNode","historyRev","tryCatchInChangeListener","pending","lastSeq","Changes$1","complete","removeAllListeners","onDestroy","cancel","isCancelled","validateChanges","processChange","changeList","style","_conflicts","compare","left","right","yankError","cleanDocs","_deleted","atts","compareByIdThenRev","idCompare","aStart","_revisions","bStart","computeHeight","height","edges","prnt","rev$$1","from","edge","allDocsKeysParse","skip","limit","descending","doNextCompaction","task","_compactionQueue","catch","last_seq","_compact","shift","attachmentNameError","charAt","AbstractPouchDB","TaskQueue","parseAdapter","match","adapter","adapters","PouchDB","preferredAdapters","prefix","adapterName","usePrefix","use_prefix","prepareForDestruction","onDestroyed","from_constructor","onClosed","__opts","auto_compaction","prefixedName","backend","_adapter","valid","fail","ready","_changesFilterPlugin","validate","doChanges","continuous","live","normalize","shouldFilter","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_removeLocal","transformForceOptionToNewEditsOption","oldRevId","oldRevNum","newRevNum","newRevId","new_edits","putDoc","_put","force","putAttachment","attachmentId","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","remove","docOrId","optsOrRev","was_delete","revsDiff","count","missing","addToMissing","revId","processDoc","missingForId","_getRevisionTree","missingObj","compactDocument","maxHeight","revTree","candidates","_doCompaction","compact","return_docs","promises","row","onComplete","all","_getLocal","finishOpenRevs","existing","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","hashFoundAtRevPos","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","start_key","startkey","end_key","endkey","TypeError","incompatibleOpt","_allDocs","close","_close","_info","db_name","_type","attachmentError","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","destroyDb","_destroy","localDoc","deletedMap","trueName","RegExp","execute","AbortController","abort","f$1","fetch","h","Headers","eventEmitter","setUpEventEmitter","Pouch","destructListeners","_destructionListeners","dbList","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","url","version","getFieldFromDoc","parsedField","compare$1","parseField","fieldName","fields","current","ch","combinationFields","isCombinationalField","field","getKey","getValue","mergeAndedSelectors","selectors","selector","matcher","$eq","fieldMatchers","operator","mergeGtGte","mergeLtLte","mergeNe","mergeEq","$gte","$gt","$lte","$lt","$ne","mergeAndedSelectorsNested","isAndInSelector","isAnd","massageSelector","input","wasAnded","orOrNor","subSelector","pad","padWith","upToLength","padding","targetLength","padLeft","MIN_MAGNITUDE","MAGNITUDE_DIGITS","SEP","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","objectCollate","Infinity","isNaN","origKey","toJSON","k","val","indexify","numToIndexableString","toIndexableString","objKey","zero","parseNumber","num","originalIdx","neg","numAsString","magAsString","magnitude","parseFloat","stack","metaStack","lastMetaElement","lastElementIndex","parseIndexableString","parsedNum","parsedStr","arrayElement","objElement","ak","bk","expFormat","toExponential","magForComparison","magString","factor","abs","factorStr","toFixed","createFieldSorter","getFieldValuesAsArray","sorting","docFieldValue","aRow","bRow","aFieldValues","bFieldValues","collation","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","every","matchCominationalSelector","matchSelector","userOperator","userValue","some","orMatchers","find","matchers","fieldExists","fieldIsNotUndefined","modField","divisor","mod","arrayContainsValue","arrayContainsAllValues","arraySize","regexMatch","re","typeMatch","neValue","matchesSelector","rowsMatched","evalFilter","evalView","code","filterName","view","changesHandler","doc_ids","viewName","ddoc","mapFun","views","filterFun","filters","applyChangesFilterPlugin","toObject","reduce","reservedWords","dataWords","parseRevisionInfo","makeRevTreeFromRevisions","revisions","revisionIds","parseDoc","newEdits","dbOpts","nRevNum","revInfo","specialKey","parseBase64","preprocessString","blobType","asBinary","digest","preprocessBlob","md5","preprocessAttachment","preprocessAttachments","docInfos","overallErr","docv","docInfo","recv","processedAttachment","updateDoc","revLimit","prev","writeDoc","previousWinningRev","previouslyDeleted","isRoot","inConflict","newRev","rev_map","newRevIsDeleted","winningRev$$1","winningRevIsDeleted","delta","rootIsMissing","processDocs","fetchedDocs","tx","overallCallback","insertDoc","resultsIdx","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","docWritten","nextDoc","ADAPTER_VERSION","DOC_STORE","BY_SEQ_STORE","ATTACH_STORE","ATTACH_AND_SEQ_STORE","META_STORE","LOCAL_STORE","DETECT_BLOB_SUPPORT_STORE","safeJsonParse","parse","safeJsonStringify","json","idbError","evt","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","decodeDoc","_doc_id_rev","lastIndexOf","readBlobData","body","asBlob","fetchAttachmentsIfNecessary","txn","fetchAttachment","attObj","objectStore","onsuccess","postProcessAttachments","attNames","resolve","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","deleteOrphanedAttachments","countReq","IDBKeyRange","bound","cursor","openCursor","only","event","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","startTransaction","txnResult","onabort","ontimeout","oncomplete","updateDocCountIfReady","verifyAttachments","fetchExistingDocs","onAllDocsProcessed","idbProcessDocs","revs_limit","docCount","numFetched","readMetadata","verifyAttachment","finish","digests","filename","attErr","isUpdate","hasAttachments","writeAttachments","finishDoc","afterPutDoc","revsToDelete","metadataToStore","metaDataReq","afterPutMetadata","afterPutDocError","preventDefault","stopPropagation","getKeyReq","putReq","insertAttachmentMappings","onerror","collectResults","attachmentSaved","saveAttachment","attsAdded","attsToAdd","newAtt","runBatchedCursor","keyRange","batchSize","onBatch","keysBatch","valuesBatch","pseudoCursor","useGetAll","getAll","getAllKeys","onGetAll","onGetAllKeys","continuePseudoCursor","newKeyRange","lastKey","upper","upperOpen","lowerBound","onCursor","onSuccess","allDocsKeys","createKeyRange","inclusiveEnd","upperBound","idbAllDocs","keyRangeError","inclusive_end","onTxnComplete","updateSeq","docIdRevIndex","getMaxUpdateSeq","maxKey","fetchDocAsynchronously","allDocsInner","batchValues","batchValue","batchKeys","onResultsReady","returnVal","total_rows","checkBlobSupport","blob$$1","matchedChrome","navigator","userAgent","matchedEdge","countDocs","running","tryCode","applyNext","enqueueTask","action","docIds","numResults","docIdsToMetadata","winningDocs","metadatas","fetchWinningDocAndMetadata","winningDoc","onBatchDone","processMetadataAndWinningDoc","filtered","onGetMetadata","docIdRev","objectStores","blobSupportPromise","cachedDBs","openReqList","IdbPouch","thisCallback","init","createSchema","createObjectStore","keyPath","autoIncrement","createIndex","unique","addDeletedOrLocalIndex","createLocalStoreSchema","migrateLocalStore","localStore","local","seqCursor","addAttachAndSeqStore","migrateAttsAndSeqs","digestMap","migrateMetadata","decodeMetadataCompat","onGetMetadataSeq","fetchMetadataSeq","metadataSeq","instanceId","reqOpts","attachId","attachment","blobData","doc_count","idb_attachment_format","oldRev","ret","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","currentTarget","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","IDBPouch","pool","promiseFactories","runNext","doNext","runNextBatch","thisErr","CHANGES_BATCH_SIZE","MAX_SIMULTANEOUS_REVS","CHANGES_TIMEOUT_BUFFER","DEFAULT_HEARTBEAT","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","encodeURIComponent","preprocessAttachments$1","hasUrlPrefix","protocol","getHost","substr","user","password","auth","username","genDBUrl","genUrl","pathDel","host","port","paramsToStr","params","shouldCacheBust","ua","isIE","isTrident","isEdge","isGET","HttpPouch","dbUrl","setupPromise","ourFetch","options","headers","credentials","nAuth","token","unescape","now","fetchFun","adapterFun$$1","setup","fetchJSON","response","v","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","fetchData","typeFieldDescriptor","__proto__","fetchAllAttachments","docOrDocs","contentType","process","browser","paramStr","batch_size","heartbeat","requestTimeout","timeout","leftToFetch","feed","seq_interval","param_name","lastFetchedSeq","controller","aborted","fetchOpts","signal","fetched","raw_results_length","finished","HttpPouch$1","QueryParseError","captureStackTrace","NotFoundError","BuiltInError","promisedCallback","callbackify","fin","finalPromiseFactory","sequentialize","promiseFactory","that","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createViewSignature","reduceFun","createView","sourceDB","temporary","localDocName","cachedViews","viewSignature","_cachedViews","promiseForView","depDbName","diffFunction","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","CHANGES_BATCH_SIZE$1","parseViewName","isGenOne","emitError","createAbstractMapReduce","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","y","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","Number","coerceOptions","group_level","checkPositiveInteger","number","checkQueryParseError","startkeyName","endkeyName","group","optionName","httpQuery","MAX_URL_LENGTH","keysAsString","customQuery","_query","customViewCleanup","_viewCleanup","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","getMetaDoc","getKeyValueDocs","processKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","saveKeyValues","seqDocId","listOfDocsToPersist","docsToPersist","getQueue","updateView","updateViewInQueue","mapResults","currentSeq","processNextBatch","createDocIdsToChangesAndEmits","createIndexableKeysToKeyValues","emittedKeyValue","complexKey","reduceView","shouldGroup","groups","lvl","POSITIVE_INFINITY","last","groupKey","reduceTry","queryView","queryViewInQueue","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","onMapResultsReady","finalResults","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","httpViewCleanup","localViewCleanup","docsToViews","designDocName","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","dbsToDelete","destroyPromises","queryPromised","createViewPromise","stale","abstractQuery","abstractViewCleanup","viewCleanup","builtInReduce","_sum","_count","_stats","sumsqr","_sumsqr","getBuiltIn","reduceFunString","origMap","builtIn","abstract","mapreduce","isGenOne$1","fileHasChanged","remoteDoc","getDocAttachments","getDocAttachmentsFromTargetOrSource","src","doCheckForLocalAttachments","createBulkGetOpts","diffs","missingRevs","missingRev","getDocs","state","resultDocs","getAllDocs","bulkGetOpts","bulkGetResponse","bulkGetInfo","Boolean","hasConflicts","fetchRevisionOneDocs","getRevisionOneDocs","returnResult","CHECKPOINT_VERSION","REPLICATOR","CHECKPOINT_HISTORY_SIZE","LOWEST_SEQ","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","unshift","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","compareReplicationLogs","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","sourceId","hasSessionId","sessionId","props","rest","floor","getCheckpoint","STARTING_BACK_OFF","backOff","retry","back_off_function","backOffSet","current_back_off","removeBackOffSetter","sortObjectPropertiesByKey","queryParams","generateReplicationId","filterViewName","queryData","md5sum","replicate","currentBatch","repId","checkpointer","batches","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","start_time","docs_read","docs_written","doc_write_failures","errors","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getDiffs","getBatchDocs","got","startNextBatch","abortReplication","processPendingBatch","immediate$$1","fatalError","end_time","onChangesComplete","onChangesError","_abortChanges","abortChanges","startChanges","_addedListeners","Replication","toPouch","PouchConstructor","replicateWrapper","replicateRet","srcPouch","targetPouch","sync","Sync","canceled","optsPush","optsPull","pull","pullChange","direction","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","isChange","isDenied","isPaused","isActive","addOneListener","listener","out","success","replication","replicateMethods","other","cleanup","_readyCalled","ieee754","typedArraySupport","foo","subarray","kMaxLength","Buffer","TYPED_ARRAY_SUPPORT","createBuffer","RangeError","arg","encodingOrOffset","allocUnsafe","fromArrayBuffer","fromString","fromObject","assertSize","alloc","fill","encoding","checked","isEncoding","actual","write","fromArrayLike","byteOffset","isBuffer","copy","isnan","SlowBuffer","isView","loweredCase","utf8ToBytes","base64ToBytes","slowToString","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","swap","bidirectionalIndexOf","dir","arrayIndexOf","indexSize","arrLength","valLength","read","readUInt16BE","foundIndex","found","hexWrite","remaining","strLen","parsed","utf8Write","blitBuffer","asciiWrite","asciiToBytes","latin1Write","base64Write","ucs2Write","utf16leToBytes","fromByteArray","secondByte","thirdByte","fourthByte","tempCodePoint","firstByte","codePoint","bytesPerSequence","decodeCodePointsArray","INSPECT_MAX_BYTES","poolSize","_augment","configurable","allocUnsafeSlow","_isBuffer","list","swap16","swap32","swap64","equals","inspect","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","_arr","MAX_ARGUMENTS_LENGTH","codePoints","toHex","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","writeDouble","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","maxBytes","writeUIntBE","writeUInt8","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","INVALID_BASE64_RE","base64clean","stringtrim","trim","units","leadSurrogate","byteArray","hi","lo","toByteArray","dst","lookup","revLookup","Arr","getLens","validLen","placeHoldersLen","lens","_byteLength","tmp","curByte","tripletToBase64","encodeChunk","uint8","extraBytes","maxChunkLength","len2","isSpecificValue","cloneSpecificValue","getTime","deepCloneArray","deepExtend","safeGetProperty","ctor","superCtor","super_","writable","TempCtor","nextTick","fn","platform","arch","execPath","title","pid","env","argv","binding","cwd","chdir","exit","kill","umask","dlopen","uptime","memoryUsage","uvCounters","features","queueMicrotask","hex_chr","md5cycle","md5blk","md5blks","md5blk_array","md51","tail","md51_array","rhex","hex","toUtf8","utf8Str2ArrayBuffer","returnUInt8Array","arrayBuffer2Utf8Str","concatenateArrayBuffers","first","second","hexToBinaryString","SparkMD5","reset","lsw","msw","clamp","begin","contents","_buff","_length","_hash","_finish","getState","setState","hashBinary","content","arrayPrefix","objPrefix","numChar","parsedString","lastCh","numConsecutiveSlashes","draining","currentQueue","scheduleDrain","types","queueIndex","scheduled","cleanUpNextTick","run","clearTimeout","Item","immediate","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","getCurrentScript","descriptor","currentScript","pageSource","inlineScriptSourceRegExp","inlineScriptSource","ieStackRegExp","ffStackRegExp","stackDetails","scriptLocation","line","currentLocation","location","href","scripts","getElementsByTagName","outerHTML","readyState","innerHTML","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","rt","LN2","g","window","MessageChannel","channel","port1","onmessage","port2","postMessage","argsArray","normalizeArray","allowAboveRoot","up","basename","matchedSlash","xs","f","resolvedPath","resolvedAbsolute","isAbsolute","trailingSlash","relative","fromParts","toParts","samePartsLength","outputParts","sep","delimiter","dirname","hasRoot","extname","startDot","startPart","preDotState","getRandomValues","crypto","msCrypto","rnds8","rng","byteToHex","bytesToUuid","bth","v4","rnds","ReflectOwnKeys","R","Reflect","ReflectApply","receiver","ProcessEmitWarning","warning","warn","ownKeys","getOwnPropertySymbols","NumberIsNaN","EventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","_getMaxListeners","_addListener","prepend","events","newListener","warned","w","emitter","onceWrapper","fired","wrapFn","_onceWrap","wrapped","unwrap","evlistener","unwrapListeners","arrayClone","spliceOne","errorListener","resolver","eventTargetAgnosticAddListener","addErrorHandlerIfEventEmitter","handler","flags","wrapListener","removeEventListener","setMaxListeners","getMaxListeners","doError","er","context","prependListener","prependOnceListener","position","originalListener","off","rawListeners","eventNames","assign$1","hasName","setFieldInDoc","elem","massageCreateIndexRequest","dbFetch","getIndexes","deleteIndex","indexDef","getArguments","subArr","mergeObjects","oneArrayIsSubArrayOfOther","oneArrayIsStrictSubArrayOfOther","oneSetIsSubArrayOfOther","leftIdx","arrayToObject","maxScore","score","arrayEquals","arr1","arr2","createDeepMultiMapper","toEmit","iLen","createDeepSingleMapper","createShallowSingleMapper","createShallowMultiMapper","checkShallow","createMapper","isShallow","isSingle","mapFunDef","abstractMapper","abstractMapper$1","_customFindAbstractMapper","massageSort","massageUseIndex","useIndex","cleanedUseIndex","massageIndexDef","getKeyFromDoc","def","filterInclusiveStart","targetValue","indexFields","docKey","reverseOptions","newOpts","inclusive_start","validateIndex","ascFields","validateSort","defaultUsed","noneIdSorts","sortItem","validateFindRequest","getUserFields","userFields","selectorFields","sortFields","MAX_VALUE","rightIdx","sortOrder","createIndex$1","originalIndexDef","getMd5","ddocId","hasInvalidLanguage","viewExists","updateDdoc","language","signature","getIndexes$1","indexes","viewNames","COLLATE_LO","COLLATE_HI","SHORT_CIRCUIT_QUERY","queryOpts","checkFieldInIndex","indexField","userOperatorLosesPrecision","sortFieldsByIndex","aIdx","bIdx","getBasicInMemoryFields","needToFilterInMemory","getInMemoryFieldsFromNe","getInMemoryFields","coreInMemoryFields","checkIndexFieldsMatch","sortMatches","selectorMatches","logicalMatchers","isNonLogicalMatcher","checkFieldsLogicallySound","firstField","isInvalidNe","checkIndexMatches","fieldsMatch","findMatchingIndexes","findBestMatchingIndex","matchingIndexes","defaultIndex","userFieldsMap","scoreIndex","useIndexDdoc","useIndexName","getSingleFieldQueryOptsFor","getSingleFieldCoreQueryPlan","combinedOpts","userOperators","newQueryOpts","getMultiFieldCoreQueryPlan","getMultiFieldQueryOpts","inclusiveStart","usingGtlt","previousKeys","previousWasEq","previousWasSame","gtltLostSpecificity","shouldShortCircuit","getDefaultQueryPlan","getCoreQueryPlan","planQuery","userFieldsRes","use_index","coreQueryPlan","indexToSignature","doAllDocs","originalOpts","indexes_count","original_limit","find$1","explain","getIndexesRes","queryPlan","indexToUse","isDescending","explain$1","dbname","bookmark","deleteIndex$1","deltaFun","createIndexAsCallback","findAsCallback","explainAsCallback","getIndexesAsCallback","deleteIndexAsCallback","createIndex$$1","find$$1","getIndexes$$1","deleteIndex$$1","carry","isJson","findKey","$or","findCacheSelector","findFirstKey","firstOrFail","findConfig","findCache","config","save","retryUntilSucceeds","$cache","$exists","$expiredAt","purge","clearExpiredAt","$and","$type","cache","$cachedAt","PouchFind","VUE_APP_DB_NAME","DEFAULT_DRIVER","vuex","initialize","watch","deep","replaceState","resetStateToDefault","driver","initialized"],"mappings":"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","file":"vuex-persistent-plugin.umd.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"vuex-persistent-plugin\"] = factory();\n\telse\n\t\troot[\"vuex-persistent-plugin\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"fae3\");\n","'use strict';\n//based off rsvp https://github.com/tildeio/rsvp.js\n//license https://github.com/tildeio/rsvp.js/blob/master/LICENSE\n//https://github.com/tildeio/rsvp.js/blob/master/lib/rsvp/asap.js\n\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nexports.test = function () {\n  return Mutation;\n};\n\nexports.install = function (handle) {\n  var called = 0;\n  var observer = new Mutation(handle);\n  var element = global.document.createTextNode('');\n  observer.observe(element, {\n    characterData: true\n  });\n  return function () {\n    element.data = (called = ++called % 2);\n  };\n};","import immediate from 'immediate';\nimport { v4 } from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport EE from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EE);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EE.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EE.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    var names = Object.getOwnPropertyNames(error);\n    for (var i = 0, len = names.length; i < len; i++) {\n      if (typeof error[names[i]] !== 'function') {\n        this[names[i]] = error[names[i]];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EE.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = self.setImmediate || self.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = v4; // mimic old import, only v4 is ever used elsewhere\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EE);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EE.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EE);\n\nfunction AbstractPouchDB() {\n  EE.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EE();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EE.prototype).forEach(function (key) {\n    if (typeof EE.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.2.2\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-/.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending  no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function (e) {\n    var msg = e.target.error && e.target.error.message;\n\n    if (!msg) {\n      msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    } else if (msg.indexOf(\"stored database is a higher version\") !== -1) {\n      msg = new Error('This DB was created with the newer \"indexeddb\" adapter, but you are trying to open it with the older \"idb\" adapter');\n    }\n\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if ('buffer' in response) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            var typeFieldDescriptor = Object.getOwnPropertyDescriptor(blob.__proto__, 'type');\n            if (!typeFieldDescriptor || typeFieldDescriptor.set) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser && typeof response.buffer === 'function') {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EE);\nfunction Replication() {\n  EE.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EE);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","/*!\n * @description Recursive object extending\n * @author Viacheslav Lotsmanov <lotsmanov89@gmail.com>\n * @license MIT\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2013-2018 Viacheslav Lotsmanov\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n * the Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n'use strict';\n\nfunction isSpecificValue(val) {\n\treturn (\n\t\tval instanceof Buffer\n\t\t|| val instanceof Date\n\t\t|| val instanceof RegExp\n\t) ? true : false;\n}\n\nfunction cloneSpecificValue(val) {\n\tif (val instanceof Buffer) {\n\t\tvar x = Buffer.alloc\n\t\t\t? Buffer.alloc(val.length)\n\t\t\t: new Buffer(val.length);\n\t\tval.copy(x);\n\t\treturn x;\n\t} else if (val instanceof Date) {\n\t\treturn new Date(val.getTime());\n\t} else if (val instanceof RegExp) {\n\t\treturn new RegExp(val);\n\t} else {\n\t\tthrow new Error('Unexpected situation');\n\t}\n}\n\n/**\n * Recursive cloning array.\n */\nfunction deepCloneArray(arr) {\n\tvar clone = [];\n\tarr.forEach(function (item, index) {\n\t\tif (typeof item === 'object' && item !== null) {\n\t\t\tif (Array.isArray(item)) {\n\t\t\t\tclone[index] = deepCloneArray(item);\n\t\t\t} else if (isSpecificValue(item)) {\n\t\t\t\tclone[index] = cloneSpecificValue(item);\n\t\t\t} else {\n\t\t\t\tclone[index] = deepExtend({}, item);\n\t\t\t}\n\t\t} else {\n\t\t\tclone[index] = item;\n\t\t}\n\t});\n\treturn clone;\n}\n\nfunction safeGetProperty(object, property) {\n\treturn property === '__proto__' ? undefined : object[property];\n}\n\n/**\n * Extening object that entered in first argument.\n *\n * Returns extended object or false if have no target object or incorrect type.\n *\n * If you wish to clone source object (without modify it), just use empty new\n * object as first argument, like this:\n *   deepExtend({}, yourObj_1, [yourObj_N]);\n */\nvar deepExtend = module.exports = function (/*obj_1, [obj_2], [obj_N]*/) {\n\tif (arguments.length < 1 || typeof arguments[0] !== 'object') {\n\t\treturn false;\n\t}\n\n\tif (arguments.length < 2) {\n\t\treturn arguments[0];\n\t}\n\n\tvar target = arguments[0];\n\n\t// convert arguments to array and cut off target object\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tvar val, src, clone;\n\n\targs.forEach(function (obj) {\n\t\t// skip argument if isn't an object, is null, or is an array\n\t\tif (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n\t\t\treturn;\n\t\t}\n\n\t\tObject.keys(obj).forEach(function (key) {\n\t\t\tsrc = safeGetProperty(target, key); // source value\n\t\t\tval = safeGetProperty(obj, key); // new value\n\n\t\t\t// recursion prevention\n\t\t\tif (val === target) {\n\t\t\t\treturn;\n\n\t\t\t/**\n\t\t\t * if new value isn't object then just overwrite by new value\n\t\t\t * instead of extending.\n\t\t\t */\n\t\t\t} else if (typeof val !== 'object' || val === null) {\n\t\t\t\ttarget[key] = val;\n\t\t\t\treturn;\n\n\t\t\t// just clone arrays (and recursive clone objects inside)\n\t\t\t} else if (Array.isArray(val)) {\n\t\t\t\ttarget[key] = deepCloneArray(val);\n\t\t\t\treturn;\n\n\t\t\t// custom cloning and overwrite for specific objects\n\t\t\t} else if (isSpecificValue(val)) {\n\t\t\t\ttarget[key] = cloneSpecificValue(val);\n\t\t\t\treturn;\n\n\t\t\t// overwrite by new value if source isn't object or array\n\t\t\t} else if (typeof src !== 'object' || src === null || Array.isArray(src)) {\n\t\t\t\ttarget[key] = deepExtend({}, val);\n\t\t\t\treturn;\n\n\t\t\t// source value and new value is objects both, extending...\n\t\t\t} else {\n\t\t\t\ttarget[key] = deepExtend(src, val);\n\t\t\t\treturn;\n\t\t\t}\n\t\t});\n\t});\n\n\treturn target;\n};\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","exports.nextTick = function nextTick(fn) {\n    var args = Array.prototype.slice.call(arguments);\n    args.shift();\n    setTimeout(function () {\n        fn.apply(null, args);\n    }, 0);\n};\n\nexports.platform = exports.arch = \nexports.execPath = exports.title = 'browser';\nexports.pid = 1;\nexports.browser = true;\nexports.env = {};\nexports.argv = [];\n\nexports.binding = function (name) {\n\tthrow new Error('No such module. (Possibly not yet loaded)')\n};\n\n(function () {\n    var cwd = '/';\n    var path;\n    exports.cwd = function () { return cwd };\n    exports.chdir = function (dir) {\n        if (!path) path = require('path');\n        cwd = path.resolve(dir, cwd);\n    };\n})();\n\nexports.exit = exports.kill = \nexports.umask = exports.dlopen = \nexports.uptime = exports.memoryUsage = \nexports.uvCounters = function() {};\nexports.features = {};\n","'use strict';\nexports.test = function () {\n  return typeof global.queueMicrotask === 'function';\n};\n\nexports.install = function (func) {\n  return function () {\n    global.queueMicrotask(func);\n  };\n};\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash.slice()\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} [raw] True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} [raw]     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     [raw] True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","'use strict';\nvar types = [\n  require('./nextTick'),\n  require('./queueMicrotask'),\n  require('./mutation.js'),\n  require('./messageChannel'),\n  require('./stateChange'),\n  require('./timeout')\n];\nvar draining;\nvar currentQueue;\nvar queueIndex = -1;\nvar queue = [];\nvar scheduled = false;\nfunction cleanUpNextTick() {\n  if (!draining || !currentQueue) {\n    return;\n  }\n  draining = false;\n  if (currentQueue.length) {\n    queue = currentQueue.concat(queue);\n  } else {\n    queueIndex = -1;\n  }\n  if (queue.length) {\n    nextTick();\n  }\n}\n\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  if (draining) {\n    return;\n  }\n  scheduled = false;\n  draining = true;\n  var len = queue.length;\n  var timeout = setTimeout(cleanUpNextTick);\n  while (len) {\n    currentQueue = queue;\n    queue = [];\n    while (currentQueue && ++queueIndex < len) {\n      currentQueue[queueIndex].run();\n    }\n    queueIndex = -1;\n    len = queue.length;\n  }\n  currentQueue = null;\n  queueIndex = -1;\n  draining = false;\n  clearTimeout(timeout);\n}\nvar scheduleDrain;\nvar i = -1;\nvar len = types.length;\nwhile (++i < len) {\n  if (types[i] && types[i].test && types[i].test()) {\n    scheduleDrain = types[i].install(nextTick);\n    break;\n  }\n}\n// v8 likes predictible objects\nfunction Item(fun, array) {\n  this.fun = fun;\n  this.array = array;\n}\nItem.prototype.run = function () {\n  var fun = this.fun;\n  var array = this.array;\n  switch (array.length) {\n  case 0:\n    return fun();\n  case 1:\n    return fun(array[0]);\n  case 2:\n    return fun(array[0], array[1]);\n  case 3:\n    return fun(array[0], array[1], array[2]);\n  default:\n    return fun.apply(null, array);\n  }\n\n};\nmodule.exports = immediate;\nfunction immediate(task) {\n  var args = new Array(arguments.length - 1);\n  if (arguments.length > 1) {\n    for (var i = 1; i < arguments.length; i++) {\n      args[i - 1] = arguments[i];\n    }\n  }\n  queue.push(new Item(task, args));\n  if (!scheduled && !draining) {\n    scheduled = true;\n    scheduleDrain();\n  }\n}\n","'use strict';\n\nexports.test = function () {\n  return 'document' in global && 'onreadystatechange' in global.document.createElement('script');\n};\n\nexports.install = function (handle) {\n  return function () {\n\n    // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n    // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n    var scriptEl = global.document.createElement('script');\n    scriptEl.onreadystatechange = function () {\n      handle();\n\n      scriptEl.onreadystatechange = null;\n      scriptEl.parentNode.removeChild(scriptEl);\n      scriptEl = null;\n    };\n    global.document.documentElement.appendChild(scriptEl);\n\n    return handle;\n  };\n};","// addapted from the document.currentScript polyfill by Adam Miller\n// MIT license\n// source: https://github.com/amiller-gh/currentScript-polyfill\n\n// added support for Firefox https://bugzilla.mozilla.org/show_bug.cgi?id=1620505\n\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory();\n  } else {\n    root.getCurrentScript = factory();\n  }\n}(typeof self !== 'undefined' ? self : this, function () {\n  function getCurrentScript () {\n    var descriptor = Object.getOwnPropertyDescriptor(document, 'currentScript')\n    // for chrome\n    if (!descriptor && 'currentScript' in document && document.currentScript) {\n      return document.currentScript\n    }\n\n    // for other browsers with native support for currentScript\n    if (descriptor && descriptor.get !== getCurrentScript && document.currentScript) {\n      return document.currentScript\n    }\n  \n    // IE 8-10 support script readyState\n    // IE 11+ & Firefox support stack trace\n    try {\n      throw new Error();\n    }\n    catch (err) {\n      // Find the second match for the \"at\" string to get file src url from stack.\n      var ieStackRegExp = /.*at [^(]*\\((.*):(.+):(.+)\\)$/ig,\n        ffStackRegExp = /@([^@]*):(\\d+):(\\d+)\\s*$/ig,\n        stackDetails = ieStackRegExp.exec(err.stack) || ffStackRegExp.exec(err.stack),\n        scriptLocation = (stackDetails && stackDetails[1]) || false,\n        line = (stackDetails && stackDetails[2]) || false,\n        currentLocation = document.location.href.replace(document.location.hash, ''),\n        pageSource,\n        inlineScriptSourceRegExp,\n        inlineScriptSource,\n        scripts = document.getElementsByTagName('script'); // Live NodeList collection\n  \n      if (scriptLocation === currentLocation) {\n        pageSource = document.documentElement.outerHTML;\n        inlineScriptSourceRegExp = new RegExp('(?:[^\\\\n]+?\\\\n){0,' + (line - 2) + '}[^<]*<script>([\\\\d\\\\D]*?)<\\\\/script>[\\\\d\\\\D]*', 'i');\n        inlineScriptSource = pageSource.replace(inlineScriptSourceRegExp, '$1').trim();\n      }\n  \n      for (var i = 0; i < scripts.length; i++) {\n        // If ready state is interactive, return the script tag\n        if (scripts[i].readyState === 'interactive') {\n          return scripts[i];\n        }\n  \n        // If src matches, return the script tag\n        if (scripts[i].src === scriptLocation) {\n          return scripts[i];\n        }\n  \n        // If inline source matches, return the script tag\n        if (\n          scriptLocation === currentLocation &&\n          scripts[i].innerHTML &&\n          scripts[i].innerHTML.trim() === inlineScriptSource\n        ) {\n          return scripts[i];\n        }\n      }\n  \n      // If no match, return null\n      return null;\n    }\n  };\n\n  return getCurrentScript\n}));\n","/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nexports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","'use strict';\n\nexports.test = function () {\n  if (global.setImmediate) {\n    // we can only get here in IE10\n    // which doesn't handel postMessage well\n    return false;\n  }\n  return typeof global.MessageChannel !== 'undefined';\n};\n\nexports.install = function (func) {\n  var channel = new global.MessageChannel();\n  channel.port1.onmessage = func;\n  return function () {\n    channel.port2.postMessage(0);\n  };\n};","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,\n// backported and transplited with Babel, with backwards-compat fixes\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  if (path.length === 0) return '.';\n  var code = path.charCodeAt(0);\n  var hasRoot = code === 47 /*/*/;\n  var end = -1;\n  var matchedSlash = true;\n  for (var i = path.length - 1; i >= 1; --i) {\n    code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) return hasRoot ? '/' : '.';\n  if (hasRoot && end === 1) {\n    // return '//';\n    // Backwards-compat fix:\n    return '/';\n  }\n  return path.slice(0, end);\n};\n\nfunction basename(path) {\n  if (typeof path !== 'string') path = path + '';\n\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  for (i = path.length - 1; i >= 0; --i) {\n    if (path.charCodeAt(i) === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // path component\n      matchedSlash = false;\n      end = i + 1;\n    }\n  }\n\n  if (end === -1) return '';\n  return path.slice(start, end);\n}\n\n// Uses a mixed approach for backwards-compatibility, as ext behavior changed\n// in new Node.js versions, so only basename() above is backported here\nexports.basename = function (path, ext) {\n  var f = basename(path);\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\nexports.extname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true;\n  // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n  var preDotState = 0;\n  for (var i = path.length - 1; i >= 0; --i) {\n    var code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n    if (code === 46 /*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 ||\n      // We saw a non-dot character immediately before the dot\n      preDotState === 0 ||\n      // The (right-most) trimmed path component is exactly '..'\n      preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n  return path.slice(startDot, end);\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n","'use strict';\nexports.test = function () {\n  return true;\n};\n\nexports.install = function (t) {\n  return function () {\n    setTimeout(t, 0);\n  };\n};","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n// find the complete implementation of crypto (msCrypto) on IE11.\nvar getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  if (!getRandomValues) {\n    throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n  }\n\n  return getRandomValues(rnds8);\n}","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex; // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n\n  return (bth[buf[i + 0]] + bth[buf[i + 1]] + bth[buf[i + 2]] + bth[buf[i + 3]] + '-' + bth[buf[i + 4]] + bth[buf[i + 5]] + '-' + bth[buf[i + 6]] + bth[buf[i + 7]] + '-' + bth[buf[i + 8]] + bth[buf[i + 9]] + '-' + bth[buf[i + 10]] + bth[buf[i + 11]] + bth[buf[i + 12]] + bth[buf[i + 13]] + bth[buf[i + 14]] + bth[buf[i + 15]]).toLowerCase();\n}\n\nexport default bytesToUuid;","import rng from './rng.js';\nimport bytesToUuid from './bytesToUuid.js';\n\nfunction v4(options, buf, offset) {\n  if (typeof options === 'string') {\n    buf = options === 'binary' ? new Uint8Array(16) : null;\n    options = null;\n  }\n\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    var start = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[start + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return bytesToUuid(rnds);\n}\n\nexport default v4;","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","// This file is imported into lib/wc client bundles.\n\nif (typeof window !== 'undefined') {\n  var currentScript = window.document.currentScript\n  if (process.env.NEED_CURRENTSCRIPT_POLYFILL) {\n    var getCurrentScript = require('@soda/get-current-script')\n    currentScript = getCurrentScript()\n\n    // for backward compatibility, because previously we directly included the polyfill\n    if (!('currentScript' in document)) {\n      Object.defineProperty(document, 'currentScript', { get: getCurrentScript })\n    }\n  }\n\n  var src = currentScript && currentScript.src.match(/(.+\\/)[^/]+\\.js(\\?.*)?$/)\n  if (src) {\n    __webpack_public_path__ = src[1] // eslint-disable-line\n  }\n}\n\n// Indicate to webpack that this file can be concatenated\nexport default null\n","import inherits from 'inherits';\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    var names = Object.getOwnPropertyNames(error);\n    for (var i = 0, len = names.length; i < len; i++) {\n      if (typeof error[names[i]] !== 'function') {\n        this[names[i]] = error[names[i]];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nexport { UNAUTHORIZED, MISSING_BULK_DOCS, MISSING_DOC, REV_CONFLICT, INVALID_ID, MISSING_ID, RESERVED_ID, NOT_OPEN, UNKNOWN_ERROR, BAD_ARG, INVALID_REQUEST, QUERY_PARSE_ERROR, DOC_VALIDATION, BAD_REQUEST, NOT_AN_OBJECT, DB_MISSING, WSQ_ERROR, LDB_ERROR, FORBIDDEN, INVALID_REV, FILE_EXISTS, MISSING_STUB, IDB_ERROR, INVALID_URL, createError, generateErrorFromResponse };\n","// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f = fetch;\nvar h = Headers;\n\nexport { f as fetch, h as Headers, a as AbortController };\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","var thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\nfunction typedBuffer() {\n}\n\nexport { thisAtob as atob, thisBtoa as btoa, b64ToBluffer as base64StringToBlobOrBuffer, binaryStringToArrayBuffer, binStringToBluffer as binaryStringToBlobOrBuffer, createBlob as blob, blobToBase64 as blobOrBufferToBase64, blobToBinaryString as blobOrBufferToBinaryString, readAsArrayBuffer, readAsBinaryString, typedBuffer };\n","function pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\nexport { collate, normalizeKey, toIndexableString, parseIndexableString };\n","import { btoa, readAsArrayBuffer } from 'pouchdb-binary-utils';\nimport Md5 from 'spark-md5';\n\nvar setImmediateShim = self.setImmediate || self.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return btoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nexport { binaryMd5, stringMd5 };\n","import getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport inherits from 'inherits';\nimport immediate from 'immediate';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport EventEmitter from 'events';\nimport { v4 } from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = v4; // mimic old import, only v4 is ever used elsewhere\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","import { Set } from 'pouchdb-collections';\nimport argsarray from 'argsarray';\nimport { nextTick } from 'pouchdb-utils';\nimport inherits from 'inherits';\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      nextTick(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      nextTick(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return argsarray(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new Set(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nexport { uniq, sequentialize, fin, callbackify, promisedCallback, mapToKeysArray, QueryParseError, NotFoundError, BuiltInError };\n","import { Set, Map } from 'pouchdb-collections';\nimport { base64StringToBlobOrBuffer } from 'pouchdb-binary-utils';\nimport { collate, toIndexableString, normalizeKey, parseIndexableString } from 'pouchdb-collate';\nimport { generateErrorFromResponse } from 'pouchdb-errors';\nimport { Headers } from 'pouchdb-fetch';\nimport { upsert, flatten, guardedConsole, nextTick, isRemote } from 'pouchdb-utils';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { callbackify, sequentialize, uniq, fin, promisedCallback, mapToKeysArray, QueryParseError, NotFoundError, BuiltInError } from 'pouchdb-mapreduce-utils';\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue();\nvar CHANGES_BATCH_SIZE = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = base64StringToBlobOrBuffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new Headers({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new Headers({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new Set();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new Map();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new Map();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new Map();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new Headers({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new Map();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new Set();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              nextTick(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nexport default createAbstractMapReduce;\n","import { clone } from 'pouchdb-utils';\nimport { collate } from 'pouchdb-collate';\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction setFieldInDoc(doc, parsedField, value) {\n  for (var i = 0, len = parsedField.length; i < len-1; i++) {\n    var elem = parsedField[i];\n    doc = doc[elem] = doc[elem] || {};\n  }\n  doc[parsedField[len-1]] = value;\n}\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nexport { massageSelector, matchesSelector, filterInMemoryFields, createFieldSorter, rowFilter, isCombinationalField, getKey, getValue, getFieldFromDoc, setFieldInDoc, compare, parseField };\n","import { generateErrorFromResponse } from 'pouchdb-errors';\nimport { Headers } from 'pouchdb-fetch';\nimport abstractMapReduce from 'pouchdb-abstract-mapreduce';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { collate } from 'pouchdb-collate';\nimport { getFieldFromDoc, setFieldInDoc, parseField, getKey, getValue, compare, massageSelector, filterInMemoryFields } from 'pouchdb-selector-core';\nimport { clone, assign, nextTick, upsert, toPromise, isRemote } from 'pouchdb-utils';\n\n// we restucture the supplied JSON considerably, because the official\n// Mango API is very particular about a lot of this stuff, but we like\n// to be liberal with what we accept in order to prevent mental\n// breakdowns in our users\nfunction massageCreateIndexRequest(requestDef) {\n  requestDef = clone(requestDef);\n\n  if (!requestDef.index) {\n    requestDef.index = {};\n  }\n\n  ['type', 'name', 'ddoc'].forEach(function (key) {\n    if (requestDef.index[key]) {\n      requestDef[key] = requestDef.index[key];\n      delete requestDef.index[key];\n    }\n  });\n\n  if (requestDef.fields) {\n    requestDef.index.fields = requestDef.fields;\n    delete requestDef.fields;\n  }\n\n  if (!requestDef.type) {\n    requestDef.type = 'json';\n  }\n  return requestDef;\n}\n\nfunction dbFetch(db, path, opts, callback) {\n  var status, ok;\n  opts.headers = new Headers({'Content-type': 'application/json'});\n  db.fetch(path, opts).then(function (response) {\n    status = response.status;\n    ok = response.ok;\n    return response.json();\n  }).then(function (json) {\n    if (!ok) {\n      json.status = status;\n      var err = generateErrorFromResponse(json);\n      callback(err);\n    } else {\n      callback(null, json);\n    }\n  }).catch(callback);\n}\n\nfunction createIndex(db, requestDef, callback) {\n  requestDef = massageCreateIndexRequest(requestDef);\n  dbFetch(db, '_index', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction find(db, requestDef, callback) {\n  dbFetch(db, '_find', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction explain(db, requestDef, callback) {\n  dbFetch(db, '_explain', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction getIndexes(db, callback) {\n  dbFetch(db, '_index', {\n    method: 'GET'\n  }, callback);\n}\n\nfunction deleteIndex(db, indexDef, callback) {\n\n\n  var ddoc = indexDef.ddoc;\n  var type = indexDef.type || 'json';\n  var name = indexDef.name;\n\n  if (!ddoc) {\n    return callback(new Error('you must provide an index\\'s ddoc'));\n  }\n\n  if (!name) {\n    return callback(new Error('you must provide an index\\'s name'));\n  }\n\n  var url = '_index/' + [ddoc, type, name].map(encodeURIComponent).join('/');\n\n  dbFetch(db, url, {method: 'DELETE'}, callback);\n}\n\nfunction getArguments(fun) {\n  return function () {\n    var len = arguments.length;\n    var args = new Array(len);\n    var i = -1;\n    while (++i < len) {\n      args[i] = arguments[i];\n    }\n    return fun.call(this, args);\n  };\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    promisedCallback(promise, cb);\n    return promise;\n  });\n}\n\nfunction promisedCallback(promise, callback) {\n  promise.then(function (res) {\n    nextTick(function () {\n      callback(null, res);\n    });\n  }, function (reason) {\n    nextTick(function () {\n      callback(reason);\n    });\n  });\n  return promise;\n}\n\nvar flatten = getArguments(function (args) {\n  var res = [];\n  for (var i = 0, len = args.length; i < len; i++) {\n    var subArr = args[i];\n    if (Array.isArray(subArr)) {\n      res = res.concat(flatten.apply(null, subArr));\n    } else {\n      res.push(subArr);\n    }\n  }\n  return res;\n});\n\nfunction mergeObjects(arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    res = assign(res, arr[i]);\n  }\n  return res;\n}\n\n// Selects a list of fields defined in dot notation from one doc\n// and copies them to a new doc. Like underscore _.pick but supports nesting.\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var parsedField = parseField(arr[i]);\n    var value = getFieldFromDoc(obj, parsedField);\n    if (typeof value !== 'undefined') {\n      setFieldInDoc(res, parsedField, value);\n    }\n  }\n  return res;\n}\n\n// e.g. ['a'], ['a', 'b'] is true, but ['b'], ['a', 'b'] is false\nfunction oneArrayIsSubArrayOfOther(left, right) {\n\n  for (var i = 0, len = Math.min(left.length, right.length); i < len; i++) {\n    if (left[i] !== right[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// e.g.['a', 'b', 'c'], ['a', 'b'] is false\nfunction oneArrayIsStrictSubArrayOfOther(left, right) {\n\n  if (left.length > right.length) {\n    return false;\n  }\n\n  return oneArrayIsSubArrayOfOther(left, right);\n}\n\n// same as above, but treat the left array as an unordered set\n// e.g. ['b', 'a'], ['a', 'b', 'c'] is true, but ['c'], ['a', 'b', 'c'] is false\nfunction oneSetIsSubArrayOfOther(left, right) {\n  left = left.slice();\n  for (var i = 0, len = right.length; i < len; i++) {\n    var field = right[i];\n    if (!left.length) {\n      break;\n    }\n    var leftIdx = left.indexOf(field);\n    if (leftIdx === -1) {\n      return false;\n    } else {\n      left.splice(leftIdx, 1);\n    }\n  }\n  return true;\n}\n\nfunction arrayToObject(arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    res[arr[i]] = true;\n  }\n  return res;\n}\n\nfunction max(arr, fun) {\n  var max = null;\n  var maxScore = -1;\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var element = arr[i];\n    var score = fun(element);\n    if (score > maxScore) {\n      maxScore = score;\n      max = element;\n    }\n  }\n  return max;\n}\n\nfunction arrayEquals(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (var i = 0, len = arr1.length; i < len; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction uniq(arr) {\n  var obj = {};\n  for (var i = 0; i < arr.length; i++) {\n    obj['$' + arr[i]] = true;\n  }\n  return Object.keys(obj).map(function (key) {\n    return key.substring(1);\n  });\n}\n\n//\n// One thing about these mappers:\n//\n// Per the advice of John-David Dalton (http://youtu.be/NthmeLEhDDM),\n// what you want to do in this case is optimize for the smallest possible\n// function, since that's the thing that gets run over and over again.\n//\n// This code would be a lot simpler if all the if/elses were inside\n// the function, but it would also be a lot less performant.\n//\n\n\nfunction createDeepMultiMapper(fields, emit) {\n  return function (doc) {\n    var toEmit = [];\n    for (var i = 0, iLen = fields.length; i < iLen; i++) {\n      var parsedField = parseField(fields[i]);\n      var value = doc;\n      for (var j = 0, jLen = parsedField.length; j < jLen; j++) {\n        var key = parsedField[j];\n        value = value[key];\n        if (typeof value === 'undefined') {\n          return; // don't emit\n        }\n      }\n      toEmit.push(value);\n    }\n    emit(toEmit);\n  };\n}\n\nfunction createDeepSingleMapper(field, emit) {\n  var parsedField = parseField(field);\n  return function (doc) {\n    var value = doc;\n    for (var i = 0, len = parsedField.length; i < len; i++) {\n      var key = parsedField[i];\n      value = value[key];\n      if (typeof value === 'undefined') {\n        return; // do nothing\n      }\n    }\n    emit(value);\n  };\n}\n\nfunction createShallowSingleMapper(field, emit) {\n  return function (doc) {\n    emit(doc[field]);\n  };\n}\n\nfunction createShallowMultiMapper(fields, emit) {\n  return function (doc) {\n    var toEmit = [];\n    for (var i = 0, len = fields.length; i < len; i++) {\n      toEmit.push(doc[fields[i]]);\n    }\n    emit(toEmit);\n  };\n}\n\nfunction checkShallow(fields) {\n  for (var i = 0, len = fields.length; i < len; i++) {\n    var field = fields[i];\n    if (field.indexOf('.') !== -1) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction createMapper(fields, emit) {\n  var isShallow = checkShallow(fields);\n  var isSingle = fields.length === 1;\n\n  // notice we try to optimize for the most common case,\n  // i.e. single shallow indexes\n  if (isShallow) {\n    if (isSingle) {\n      return createShallowSingleMapper(fields[0], emit);\n    } else { // multi\n      return createShallowMultiMapper(fields, emit);\n    }\n  } else { // deep\n    if (isSingle) {\n      return createDeepSingleMapper(fields[0], emit);\n    } else { // multi\n      return createDeepMultiMapper(fields, emit);\n    }\n  }\n}\n\nfunction mapper(mapFunDef, emit) {\n  // mapFunDef is a list of fields\n\n  var fields = Object.keys(mapFunDef.fields);\n\n  return createMapper(fields, emit);\n}\n\n/* istanbul ignore next */\nfunction reducer(/*reduceFunDef*/) {\n  throw new Error('reduce not supported');\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var view = ddoc.views[viewName];\n  // This doesn't actually need to be here apparently, but\n  // I feel safer keeping it.\n  /* istanbul ignore if */\n  if (!view.map || !view.map.fields) {\n    throw new Error('ddoc ' + ddoc._id +' with view ' + viewName +\n      ' doesn\\'t have map.fields defined. ' +\n      'maybe it wasn\\'t created by this plugin?');\n  }\n}\n\nvar abstractMapper = abstractMapReduce(\n  /* localDocName */ 'indexes',\n  mapper,\n  reducer,\n  ddocValidator\n);\n\nfunction abstractMapper$1 (db) {\n  return db._customFindAbstractMapper || abstractMapper;\n}\n\n// normalize the \"sort\" value\nfunction massageSort(sort) {\n  if (!Array.isArray(sort)) {\n    throw new Error('invalid sort json - should be an array');\n  }\n  return sort.map(function (sorting) {\n    if (typeof sorting === 'string') {\n      var obj = {};\n      obj[sorting] = 'asc';\n      return obj;\n    } else {\n      return sorting;\n    }\n  });\n}\n\nfunction massageUseIndex(useIndex) {\n  var cleanedUseIndex = [];\n  if (typeof useIndex === 'string') {\n    cleanedUseIndex.push(useIndex);\n  } else {\n    cleanedUseIndex = useIndex;\n  }\n\n  return cleanedUseIndex.map(function (name) {\n    return name.replace('_design/', '');\n  });\n}\n\nfunction massageIndexDef(indexDef) {\n  indexDef.fields = indexDef.fields.map(function (field) {\n    if (typeof field === 'string') {\n      var obj = {};\n      obj[field] = 'asc';\n      return obj;\n    }\n    return field;\n  });\n  return indexDef;\n}\n\nfunction getKeyFromDoc(doc, index) {\n  var res = [];\n  for (var i = 0; i < index.def.fields.length; i++) {\n    var field = getKey(index.def.fields[i]);\n    res.push(doc[field]);\n  }\n  return res;\n}\n\n// have to do this manually because REASONS. I don't know why\n// CouchDB didn't implement inclusive_start\nfunction filterInclusiveStart(rows, targetValue, index) {\n  var indexFields = index.def.fields;\n  for (var i = 0, len = rows.length; i < len; i++) {\n    var row = rows[i];\n\n    // shave off any docs at the beginning that are <= the\n    // target value\n\n    var docKey = getKeyFromDoc(row.doc, index);\n    if (indexFields.length === 1) {\n      docKey = docKey[0]; // only one field, not multi-field\n    } else { // more than one field in index\n      // in the case where e.g. the user is searching {$gt: {a: 1}}\n      // but the index is [a, b], then we need to shorten the doc key\n      while (docKey.length > targetValue.length) {\n        docKey.pop();\n      }\n    }\n    //ABS as we just looking for values that don't match\n    if (Math.abs(collate(docKey, targetValue)) > 0) {\n      // no need to filter any further; we're past the key\n      break;\n    }\n  }\n  return i > 0 ? rows.slice(i) : rows;\n}\n\nfunction reverseOptions(opts) {\n  var newOpts = clone(opts);\n  delete newOpts.startkey;\n  delete newOpts.endkey;\n  delete newOpts.inclusive_start;\n  delete newOpts.inclusive_end;\n\n  if ('endkey' in opts) {\n    newOpts.startkey = opts.endkey;\n  }\n  if ('startkey' in opts) {\n    newOpts.endkey = opts.startkey;\n  }\n  if ('inclusive_start' in opts) {\n    newOpts.inclusive_end = opts.inclusive_start;\n  }\n  if ('inclusive_end' in opts) {\n    newOpts.inclusive_start = opts.inclusive_end;\n  }\n  return newOpts;\n}\n\nfunction validateIndex(index) {\n  var ascFields = index.fields.filter(function (field) {\n    return getValue(field) === 'asc';\n  });\n  if (ascFields.length !== 0 && ascFields.length !== index.fields.length) {\n    throw new Error('unsupported mixed sorting');\n  }\n}\n\nfunction validateSort(requestDef, index) {\n  if (index.defaultUsed && requestDef.sort) {\n    var noneIdSorts = requestDef.sort.filter(function (sortItem) {\n      return Object.keys(sortItem)[0] !== '_id';\n    }).map(function (sortItem) {\n      return Object.keys(sortItem)[0];\n    });\n\n    if (noneIdSorts.length > 0) {\n      throw new Error('Cannot sort on field(s) \"' + noneIdSorts.join(',') +\n      '\" when using the default index');\n    }\n  }\n\n  if (index.defaultUsed) {\n    return;\n  }\n}\n\nfunction validateFindRequest(requestDef) {\n  if (typeof requestDef.selector !== 'object') {\n    throw new Error('you must provide a selector when you find()');\n  }\n\n  /*var selectors = requestDef.selector['$and'] || [requestDef.selector];\n  for (var i = 0; i < selectors.length; i++) {\n    var selector = selectors[i];\n    var keys = Object.keys(selector);\n    if (keys.length === 0) {\n      throw new Error('invalid empty selector');\n    }\n    //var selection = selector[keys[0]];\n    /*if (Object.keys(selection).length !== 1) {\n      throw new Error('invalid selector: ' + JSON.stringify(selection) +\n        ' - it must have exactly one key/value');\n    }\n  }*/\n}\n\n// determine the maximum number of fields\n// we're going to need to query, e.g. if the user\n// has selection ['a'] and sorting ['a', 'b'], then we\n// need to use the longer of the two: ['a', 'b']\nfunction getUserFields(selector, sort) {\n  var selectorFields = Object.keys(selector);\n  var sortFields = sort? sort.map(getKey) : [];\n  var userFields;\n  if (selectorFields.length >= sortFields.length) {\n    userFields = selectorFields;\n  } else {\n    userFields = sortFields;\n  }\n\n  if (sortFields.length === 0) {\n    return {\n      fields: userFields\n    };\n  }\n\n  // sort according to the user's preferred sorting\n  userFields = userFields.sort(function (left, right) {\n    var leftIdx = sortFields.indexOf(left);\n    if (leftIdx === -1) {\n      leftIdx = Number.MAX_VALUE;\n    }\n    var rightIdx = sortFields.indexOf(right);\n    if (rightIdx === -1) {\n      rightIdx = Number.MAX_VALUE;\n    }\n    return leftIdx < rightIdx ? -1 : leftIdx > rightIdx ? 1 : 0;\n  });\n\n  return {\n    fields: userFields,\n    sortOrder: sort.map(getKey)\n  };\n}\n\nfunction createIndex$1(db, requestDef) {\n  requestDef = massageCreateIndexRequest(requestDef);\n  var originalIndexDef = clone(requestDef.index);\n  requestDef.index = massageIndexDef(requestDef.index);\n\n  validateIndex(requestDef.index);\n\n  // calculating md5 is expensive - memoize and only\n  // run if required\n  var md5;\n  function getMd5() {\n    return md5 || (md5 = stringMd5(JSON.stringify(requestDef)));\n  }\n\n  var viewName = requestDef.name || ('idx-' + getMd5());\n\n  var ddocName = requestDef.ddoc || ('idx-' + getMd5());\n  var ddocId = '_design/' + ddocName;\n\n  var hasInvalidLanguage = false;\n  var viewExists = false;\n\n  function updateDdoc(doc) {\n    if (doc._rev && doc.language !== 'query') {\n      hasInvalidLanguage = true;\n    }\n    doc.language = 'query';\n    doc.views = doc.views || {};\n\n    viewExists = !!doc.views[viewName];\n\n    if (viewExists) {\n      return false;\n    }\n\n    doc.views[viewName] = {\n      map: {\n        fields: mergeObjects(requestDef.index.fields)\n      },\n      reduce: '_count',\n      options: {\n        def: originalIndexDef\n      }\n    };\n\n    return doc;\n  }\n\n  db.constructor.emit('debug', ['find', 'creating index', ddocId]);\n\n  return upsert(db, ddocId, updateDdoc).then(function () {\n    if (hasInvalidLanguage) {\n      throw new Error('invalid language for ddoc with id \"' +\n      ddocId +\n      '\" (should be \"query\")');\n    }\n  }).then(function () {\n    // kick off a build\n    // TODO: abstract-pouchdb-mapreduce should support auto-updating\n    // TODO: should also use update_after, but pouchdb/pouchdb#3415 blocks me\n    var signature = ddocName + '/' + viewName;\n    return abstractMapper$1(db).query.call(db, signature, {\n      limit: 0,\n      reduce: false\n    }).then(function () {\n      return {\n        id: ddocId,\n        name: viewName,\n        result: viewExists ? 'exists' : 'created'\n      };\n    });\n  });\n}\n\nfunction getIndexes$1(db) {\n  // just search through all the design docs and filter in-memory.\n  // hopefully there aren't that many ddocs.\n  return db.allDocs({\n    startkey: '_design/',\n    endkey: '_design/\\uffff',\n    include_docs: true\n  }).then(function (allDocsRes) {\n    var res = {\n      indexes: [{\n        ddoc: null,\n        name: '_all_docs',\n        type: 'special',\n        def: {\n          fields: [{_id: 'asc'}]\n        }\n      }]\n    };\n\n    res.indexes = flatten(res.indexes, allDocsRes.rows.filter(function (row) {\n      return row.doc.language === 'query';\n    }).map(function (row) {\n      var viewNames = row.doc.views !== undefined ? Object.keys(row.doc.views) : [];\n\n      return viewNames.map(function (viewName) {\n        var view = row.doc.views[viewName];\n        return {\n          ddoc: row.id,\n          name: viewName,\n          type: 'json',\n          def: massageIndexDef(view.options.def)\n        };\n      });\n    }));\n\n    // these are sorted by view name for some reason\n    res.indexes.sort(function (left, right) {\n      return compare(left.name, right.name);\n    });\n    res.total_rows = res.indexes.length;\n    return res;\n  });\n}\n\n// couchdb lowest collation value\nvar COLLATE_LO = null;\n\n// couchdb highest collation value (TODO: well not really, but close enough amirite)\nvar COLLATE_HI = {\"\\uffff\": {}};\n\nconst SHORT_CIRCUIT_QUERY = {\n  queryOpts: { limit: 0, startkey: COLLATE_HI, endkey: COLLATE_LO },\n  inMemoryFields: [],\n};\n\n// couchdb second-lowest collation value\n\nfunction checkFieldInIndex(index, field) {\n  var indexFields = index.def.fields.map(getKey);\n  for (var i = 0, len = indexFields.length; i < len; i++) {\n    var indexField = indexFields[i];\n    if (field === indexField) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// so when you do e.g. $eq/$eq, we can do it entirely in the database.\n// but when you do e.g. $gt/$eq, the first part can be done\n// in the database, but the second part has to be done in-memory,\n// because $gt has forced us to lose precision.\n// so that's what this determines\nfunction userOperatorLosesPrecision(selector, field) {\n  var matcher = selector[field];\n  var userOperator = getKey(matcher);\n\n  return userOperator !== '$eq';\n}\n\n// sort the user fields by their position in the index,\n// if they're in the index\nfunction sortFieldsByIndex(userFields, index) {\n  var indexFields = index.def.fields.map(getKey);\n\n  return userFields.slice().sort(function (a, b) {\n    var aIdx = indexFields.indexOf(a);\n    var bIdx = indexFields.indexOf(b);\n    if (aIdx === -1) {\n      aIdx = Number.MAX_VALUE;\n    }\n    if (bIdx === -1) {\n      bIdx = Number.MAX_VALUE;\n    }\n    return compare(aIdx, bIdx);\n  });\n}\n\n// first pass to try to find fields that will need to be sorted in-memory\nfunction getBasicInMemoryFields(index, selector, userFields) {\n\n  userFields = sortFieldsByIndex(userFields, index);\n\n  // check if any of the user selectors lose precision\n  var needToFilterInMemory = false;\n  for (var i = 0, len = userFields.length; i < len; i++) {\n    var field = userFields[i];\n    if (needToFilterInMemory || !checkFieldInIndex(index, field)) {\n      return userFields.slice(i);\n    }\n    if (i < len - 1 && userOperatorLosesPrecision(selector, field)) {\n      needToFilterInMemory = true;\n    }\n  }\n  return [];\n}\n\nfunction getInMemoryFieldsFromNe(selector) {\n  var fields = [];\n  Object.keys(selector).forEach(function (field) {\n    var matcher = selector[field];\n    Object.keys(matcher).forEach(function (operator) {\n      if (operator === '$ne') {\n        fields.push(field);\n      }\n    });\n  });\n  return fields;\n}\n\nfunction getInMemoryFields(coreInMemoryFields, index, selector, userFields) {\n  var result = flatten(\n    // in-memory fields reported as necessary by the query planner\n    coreInMemoryFields,\n    // combine with another pass that checks for any we may have missed\n    getBasicInMemoryFields(index, selector, userFields),\n    // combine with another pass that checks for $ne's\n    getInMemoryFieldsFromNe(selector)\n  );\n\n  return sortFieldsByIndex(uniq(result), index);\n}\n\n// check that at least one field in the user's query is represented\n// in the index. order matters in the case of sorts\nfunction checkIndexFieldsMatch(indexFields, sortOrder, fields) {\n  if (sortOrder) {\n    // array has to be a strict subarray of index array. furthermore,\n    // the sortOrder fields need to all be represented in the index\n    var sortMatches = oneArrayIsStrictSubArrayOfOther(sortOrder, indexFields);\n    var selectorMatches = oneArrayIsSubArrayOfOther(fields, indexFields);\n\n    return sortMatches && selectorMatches;\n  }\n\n  // all of the user's specified fields still need to be\n  // on the left side of the index array, although the order\n  // doesn't matter\n  return oneSetIsSubArrayOfOther(fields, indexFields);\n}\n\nvar logicalMatchers = ['$eq', '$gt', '$gte', '$lt', '$lte'];\nfunction isNonLogicalMatcher(matcher) {\n  return logicalMatchers.indexOf(matcher) === -1;\n}\n\n// check all the index fields for usages of '$ne'\n// e.g. if the user queries {foo: {$ne: 'foo'}, bar: {$eq: 'bar'}},\n// then we can neither use an index on ['foo'] nor an index on\n// ['foo', 'bar'], but we can use an index on ['bar'] or ['bar', 'foo']\nfunction checkFieldsLogicallySound(indexFields, selector) {\n  var firstField = indexFields[0];\n  var matcher = selector[firstField];\n\n  if (typeof matcher === 'undefined') {\n    /* istanbul ignore next */\n    return true;\n  }\n\n  var isInvalidNe = Object.keys(matcher).length === 1 &&\n    getKey(matcher) === '$ne';\n\n  return !isInvalidNe;\n}\n\nfunction checkIndexMatches(index, sortOrder, fields, selector) {\n\n  var indexFields = index.def.fields.map(getKey);\n\n  var fieldsMatch = checkIndexFieldsMatch(indexFields, sortOrder, fields);\n\n  if (!fieldsMatch) {\n    return false;\n  }\n\n  return checkFieldsLogicallySound(indexFields, selector);\n}\n\n//\n// the algorithm is very simple:\n// take all the fields the user supplies, and if those fields\n// are a strict subset of the fields in some index,\n// then use that index\n//\n//\nfunction findMatchingIndexes(selector, userFields, sortOrder, indexes) {\n  return indexes.filter(function (index) {\n    return checkIndexMatches(index, sortOrder, userFields, selector);\n  });\n}\n\n// find the best index, i.e. the one that matches the most fields\n// in the user's query\nfunction findBestMatchingIndex(selector, userFields, sortOrder, indexes, useIndex) {\n\n  var matchingIndexes = findMatchingIndexes(selector, userFields, sortOrder, indexes);\n\n  if (matchingIndexes.length === 0) {\n    if (useIndex) {\n      throw {\n        error: \"no_usable_index\",\n        message: \"There is no index available for this selector.\"\n      };\n    }\n    //return `all_docs` as a default index;\n    //I'm assuming that _all_docs is always first\n    var defaultIndex = indexes[0];\n    defaultIndex.defaultUsed = true;\n    return defaultIndex;\n  }\n  if (matchingIndexes.length === 1 && !useIndex) {\n    return matchingIndexes[0];\n  }\n\n  var userFieldsMap = arrayToObject(userFields);\n\n  function scoreIndex(index) {\n    var indexFields = index.def.fields.map(getKey);\n    var score = 0;\n    for (var i = 0, len = indexFields.length; i < len; i++) {\n      var indexField = indexFields[i];\n      if (userFieldsMap[indexField]) {\n        score++;\n      }\n    }\n    return score;\n  }\n\n  if (useIndex) {\n    var useIndexDdoc = '_design/' + useIndex[0];\n    var useIndexName = useIndex.length === 2 ? useIndex[1] : false;\n    var index = matchingIndexes.find(function (index) {\n      if (useIndexName && index.ddoc === useIndexDdoc && useIndexName === index.name) {\n        return true;\n      }\n\n      if (index.ddoc === useIndexDdoc) {\n        /* istanbul ignore next */\n        return true;\n      }\n\n      return false;\n    });\n\n    if (!index) {\n      throw {\n        error: \"unknown_error\",\n        message: \"Could not find that index or could not use that index for the query\"\n      };\n    }\n    return index;\n  }\n\n  return max(matchingIndexes, scoreIndex);\n}\n\nfunction getSingleFieldQueryOptsFor(userOperator, userValue) {\n  switch (userOperator) {\n    case '$eq':\n      return {key: userValue};\n    case '$lte':\n      return {endkey: userValue};\n    case '$gte':\n      return {startkey: userValue};\n    case '$lt':\n      return {\n        endkey: userValue,\n        inclusive_end: false\n      };\n    case '$gt':\n      return {\n        startkey: userValue,\n        inclusive_start: false\n      };\n  }\n\n  return {\n    startkey: COLLATE_LO\n  };\n}\n\nfunction getSingleFieldCoreQueryPlan(selector, index) {\n  var field = getKey(index.def.fields[0]);\n  //ignoring this because the test to exercise the branch is skipped at the moment\n  /* istanbul ignore next */\n  var matcher = selector[field] || {};\n  var inMemoryFields = [];\n\n  var userOperators = Object.keys(matcher);\n\n  var combinedOpts;\n\n  userOperators.forEach(function (userOperator) {\n\n    if (isNonLogicalMatcher(userOperator)) {\n      inMemoryFields.push(field);\n    }\n\n    var userValue = matcher[userOperator];\n\n    var newQueryOpts = getSingleFieldQueryOptsFor(userOperator, userValue);\n\n    if (combinedOpts) {\n      combinedOpts = mergeObjects([combinedOpts, newQueryOpts]);\n    } else {\n      combinedOpts = newQueryOpts;\n    }\n  });\n\n  return {\n    queryOpts: combinedOpts,\n    inMemoryFields: inMemoryFields\n  };\n}\n\nfunction getMultiFieldCoreQueryPlan(userOperator, userValue) {\n  switch (userOperator) {\n    case '$eq':\n      return {\n        startkey: userValue,\n        endkey: userValue\n      };\n    case '$lte':\n      return {\n        endkey: userValue\n      };\n    case '$gte':\n      return {\n        startkey: userValue\n      };\n    case '$lt':\n      return {\n        endkey: userValue,\n        inclusive_end: false\n      };\n    case '$gt':\n      return {\n        startkey: userValue,\n        inclusive_start: false\n      };\n  }\n}\n\nfunction getMultiFieldQueryOpts(selector, index) {\n\n  var indexFields = index.def.fields.map(getKey);\n\n  var inMemoryFields = [];\n  var startkey = [];\n  var endkey = [];\n  var inclusiveStart;\n  var inclusiveEnd;\n\n\n  function finish(i) {\n\n    if (inclusiveStart !== false) {\n      startkey.push(COLLATE_LO);\n    }\n    if (inclusiveEnd !== false) {\n      endkey.push(COLLATE_HI);\n    }\n    // keep track of the fields where we lost specificity,\n    // and therefore need to filter in-memory\n    inMemoryFields = indexFields.slice(i);\n  }\n\n  for (var i = 0, len = indexFields.length; i < len; i++) {\n    var indexField = indexFields[i];\n\n    var matcher = selector[indexField];\n\n    if (!matcher || !Object.keys(matcher).length) { // fewer fields in user query than in index\n      finish(i);\n      break;\n    } else if (Object.keys(matcher).some(isNonLogicalMatcher)) { // non-logical are ignored\n      finish(i);\n      break;\n    } else if (i > 0) {\n      var usingGtlt = (\n        '$gt' in matcher || '$gte' in matcher ||\n        '$lt' in matcher || '$lte' in matcher);\n      var previousKeys = Object.keys(selector[indexFields[i - 1]]);\n      var previousWasEq = arrayEquals(previousKeys, ['$eq']);\n      var previousWasSame = arrayEquals(previousKeys, Object.keys(matcher));\n      var gtltLostSpecificity = usingGtlt && !previousWasEq && !previousWasSame;\n      if (gtltLostSpecificity) {\n        finish(i);\n        break;\n      }\n    }\n\n    var userOperators = Object.keys(matcher);\n\n    var combinedOpts = null;\n\n    for (var j = 0; j < userOperators.length; j++) {\n      var userOperator = userOperators[j];\n      var userValue = matcher[userOperator];\n\n      var newOpts = getMultiFieldCoreQueryPlan(userOperator, userValue);\n\n      if (combinedOpts) {\n        combinedOpts = mergeObjects([combinedOpts, newOpts]);\n      } else {\n        combinedOpts = newOpts;\n      }\n    }\n\n    startkey.push('startkey' in combinedOpts ? combinedOpts.startkey : COLLATE_LO);\n    endkey.push('endkey' in combinedOpts ? combinedOpts.endkey : COLLATE_HI);\n    if ('inclusive_start' in combinedOpts) {\n      inclusiveStart = combinedOpts.inclusive_start;\n    }\n    if ('inclusive_end' in combinedOpts) {\n      inclusiveEnd = combinedOpts.inclusive_end;\n    }\n  }\n\n  var res = {\n    startkey: startkey,\n    endkey: endkey\n  };\n\n  if (typeof inclusiveStart !== 'undefined') {\n    res.inclusive_start = inclusiveStart;\n  }\n  if (typeof inclusiveEnd !== 'undefined') {\n    res.inclusive_end = inclusiveEnd;\n  }\n\n  return {\n    queryOpts: res,\n    inMemoryFields: inMemoryFields\n  };\n}\n\nfunction shouldShortCircuit(selector) {\n  // We have a field to select from, but not a valid value\n  // this should result in a short circuited query \n  // just like the http adapter (couchdb) and mongodb\n  // see tests for issue #7810\n  \n  // @todo Use 'Object.values' when Node.js v6 support is dropped.\n  const values = Object.keys(selector).map(function (key) {\n    return selector[key];\n  });\n  return values.some(function (val) { \n    return typeof val === 'object' && Object.keys(val).length === 0;\n});\n}\n\nfunction getDefaultQueryPlan(selector) {\n  //using default index, so all fields need to be done in memory\n  return {\n    queryOpts: {startkey: null},\n    inMemoryFields: [Object.keys(selector)]\n  };\n}\n\nfunction getCoreQueryPlan(selector, index) {\n  if (index.defaultUsed) {\n    return getDefaultQueryPlan(selector, index);\n  }\n\n  if (index.def.fields.length === 1) {\n    // one field in index, so the value was indexed as a singleton\n    return getSingleFieldCoreQueryPlan(selector, index);\n  }\n  // else index has multiple fields, so the value was indexed as an array\n  return getMultiFieldQueryOpts(selector, index);\n}\n\nfunction planQuery(request, indexes) {\n\n  var selector = request.selector;\n  var sort = request.sort;\n\n  if (shouldShortCircuit(selector)) {\n    return assign({}, SHORT_CIRCUIT_QUERY, { index: indexes[0] });\n  }\n\n  var userFieldsRes = getUserFields(selector, sort);\n\n  var userFields = userFieldsRes.fields;\n  var sortOrder = userFieldsRes.sortOrder;\n  var index = findBestMatchingIndex(selector, userFields, sortOrder, indexes, request.use_index);\n\n  var coreQueryPlan = getCoreQueryPlan(selector, index);\n  var queryOpts = coreQueryPlan.queryOpts;\n  var coreInMemoryFields = coreQueryPlan.inMemoryFields;\n\n  var inMemoryFields = getInMemoryFields(coreInMemoryFields, index, selector, userFields);\n\n  var res = {\n    queryOpts: queryOpts,\n    index: index,\n    inMemoryFields: inMemoryFields\n  };\n  return res;\n}\n\nfunction indexToSignature(index) {\n  // remove '_design/'\n  return index.ddoc.substring(8) + '/' + index.name;\n}\n\nfunction doAllDocs(db, originalOpts) {\n  var opts = clone(originalOpts);\n\n  // CouchDB responds in weird ways when you provide a non-string to _id;\n  // we mimic the behavior for consistency. See issue66 tests for details.\n  if (opts.descending) {\n    if ('endkey' in opts && typeof opts.endkey !== 'string') {\n      opts.endkey = '';\n    }\n    if ('startkey' in opts && typeof opts.startkey !== 'string') {\n      opts.limit = 0;\n    }\n  } else {\n    if ('startkey' in opts && typeof opts.startkey !== 'string') {\n      opts.startkey = '';\n    }\n    if ('endkey' in opts && typeof opts.endkey !== 'string') {\n      opts.limit = 0;\n    }\n  }\n  if ('key' in opts && typeof opts.key !== 'string') {\n    opts.limit = 0;\n  }\n\n  if (opts.limit > 0 && opts.indexes_count) {\n    // brute force and quite naive impl.\n    // amp up the limit with the amount of (indexes) design docs\n    // or is this too naive? How about skip?\n    opts.original_limit = opts.limit;\n    opts.limit += opts.indexes_count;\n  }\n\n  return db.allDocs(opts)\n    .then(function (res) {\n      // filter out any design docs that _all_docs might return\n      res.rows = res.rows.filter(function (row) {\n        return !/^_design\\//.test(row.id);\n      });\n      // put back original limit\n      if (opts.original_limit) {\n        opts.limit = opts.original_limit;\n      }\n      // enforce the rows to respect the given limit\n      res.rows = res.rows.slice(0, opts.limit);\n      return res;\n    });\n}\n\nfunction find$1(db, requestDef, explain) {\n  if (requestDef.selector) {\n    requestDef.selector = massageSelector(requestDef.selector);\n  }\n\n  if (requestDef.sort) {\n    requestDef.sort = massageSort(requestDef.sort);\n  }\n\n  if (requestDef.use_index) {\n    requestDef.use_index = massageUseIndex(requestDef.use_index);\n  }\n\n  validateFindRequest(requestDef);\n\n  return getIndexes$1(db).then(function (getIndexesRes) {\n\n    db.constructor.emit('debug', ['find', 'planning query', requestDef]);\n    var queryPlan = planQuery(requestDef, getIndexesRes.indexes);\n    db.constructor.emit('debug', ['find', 'query plan', queryPlan]);\n    \n    var indexToUse = queryPlan.index;\n    \n    validateSort(requestDef, indexToUse);\n\n    var opts = assign({\n      include_docs: true,\n      reduce: false,\n      // Add amount of index for doAllDocs to use (related to issue #7810)\n      indexes_count: getIndexesRes.total_rows, \n    }, queryPlan.queryOpts);\n\n    if ('startkey' in opts && 'endkey' in opts &&\n        collate(opts.startkey, opts.endkey) > 0) {\n      // can't possibly return any results, startkey > endkey\n      /* istanbul ignore next */\n      return {docs: []};\n    }\n\n    var isDescending = requestDef.sort &&\n      typeof requestDef.sort[0] !== 'string' &&\n      getValue(requestDef.sort[0]) === 'desc';\n\n    if (isDescending) {\n      // either all descending or all ascending\n      opts.descending = true;\n      opts = reverseOptions(opts);\n    }\n\n    if (!queryPlan.inMemoryFields.length) {\n      // no in-memory filtering necessary, so we can let the\n      // database do the limit/skip for us\n      if ('limit' in requestDef) {\n        opts.limit = requestDef.limit;\n      }\n      if ('skip' in requestDef) {\n        opts.skip = requestDef.skip;\n      }\n    }\n\n    if (explain) {\n      return Promise.resolve(queryPlan, opts);\n    }\n\n    return Promise.resolve().then(function () {\n      if (indexToUse.name === '_all_docs') {\n        return doAllDocs(db, opts);\n      } else {\n        var signature = indexToSignature(indexToUse);\n        return abstractMapper$1(db).query.call(db, signature, opts);\n      }\n    }).then(function (res) {\n      if (opts.inclusive_start === false) {\n        // may have to manually filter the first one,\n        // since couchdb has no true inclusive_start option\n        res.rows = filterInclusiveStart(res.rows, opts.startkey, indexToUse);\n      }\n\n      if (queryPlan.inMemoryFields.length) {\n        // need to filter some stuff in-memory\n        res.rows = filterInMemoryFields(res.rows, requestDef, queryPlan.inMemoryFields);\n      }\n\n      var resp = {\n        docs: res.rows.map(function (row) {\n          var doc = row.doc;\n          if (requestDef.fields) {\n            return pick(doc, requestDef.fields);\n          }\n          return doc;\n        })\n      };\n\n      if (indexToUse.defaultUsed) {\n        resp.warning = 'No matching index found, create an index to optimize query time.';\n      }\n\n      return resp;\n    });\n  });\n}\n\nfunction explain$1(db, requestDef) {\n  return find$1(db, requestDef, true)\n  .then(function (queryPlan) {\n    return {\n      dbname: db.name,\n      index: queryPlan.index,\n      selector: requestDef.selector,\n      range: {\n        start_key: queryPlan.queryOpts.startkey,\n        end_key: queryPlan.queryOpts.endkey,\n      },\n      opts: {\n        use_index: requestDef.use_index || [],\n        bookmark: \"nil\", //hardcoded to match CouchDB since its not supported,\n        limit: requestDef.limit,\n        skip: requestDef.skip,\n        sort: requestDef.sort || {},\n        fields: requestDef.fields,\n        conflicts: false, //hardcoded to match CouchDB since its not supported,\n        r: [49], // hardcoded to match CouchDB since its not support\n      },\n      limit: requestDef.limit,\n      skip: requestDef.skip || 0,\n      fields: requestDef.fields,\n    };\n  });\n}\n\nfunction deleteIndex$1(db, index) {\n\n  if (!index.ddoc) {\n    throw new Error('you must supply an index.ddoc when deleting');\n  }\n\n  if (!index.name) {\n    throw new Error('you must supply an index.name when deleting');\n  }\n\n  var docId = index.ddoc;\n  var viewName = index.name;\n\n  function deltaFun(doc) {\n    if (Object.keys(doc.views).length === 1 && doc.views[viewName]) {\n      // only one view in this ddoc, delete the whole ddoc\n      return {_id: docId, _deleted: true};\n    }\n    // more than one view here, just remove the view\n    delete doc.views[viewName];\n    return doc;\n  }\n\n  return upsert(db, docId, deltaFun).then(function () {\n    return abstractMapper$1(db).viewCleanup.apply(db);\n  }).then(function () {\n    return {ok: true};\n  });\n}\n\nvar createIndexAsCallback = callbackify(createIndex$1);\nvar findAsCallback = callbackify(find$1);\nvar explainAsCallback = callbackify(explain$1);\nvar getIndexesAsCallback = callbackify(getIndexes$1);\nvar deleteIndexAsCallback = callbackify(deleteIndex$1);\n\nvar plugin = {};\nplugin.createIndex = toPromise(function (requestDef, callback) {\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide an index to create'));\n  }\n\n  var createIndex$$1 = isRemote(this) ?\n    createIndex : createIndexAsCallback;\n  createIndex$$1(this, requestDef, callback);\n});\n\nplugin.find = toPromise(function (requestDef, callback) {\n\n  if (typeof callback === 'undefined') {\n    callback = requestDef;\n    requestDef = undefined;\n  }\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide search parameters to find()'));\n  }\n\n  var find$$1 = isRemote(this) ? find : findAsCallback;\n  find$$1(this, requestDef, callback);\n});\n\nplugin.explain = toPromise(function (requestDef, callback) {\n\n  if (typeof callback === 'undefined') {\n    callback = requestDef;\n    requestDef = undefined;\n  }\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide search parameters to explain()'));\n  }\n\n  var find$$1 = isRemote(this) ? explain : explainAsCallback;\n  find$$1(this, requestDef, callback);\n});\n\nplugin.getIndexes = toPromise(function (callback) {\n\n  var getIndexes$$1 = isRemote(this) ? getIndexes : getIndexesAsCallback;\n  getIndexes$$1(this, callback);\n});\n\nplugin.deleteIndex = toPromise(function (indexDef, callback) {\n\n  if (typeof indexDef !== 'object') {\n    return callback(new Error('you must provide an index to delete'));\n  }\n\n  var deleteIndex$$1 = isRemote(this) ?\n    deleteIndex : deleteIndexAsCallback;\n  deleteIndex$$1(this, indexDef, callback);\n});\n\nexport default plugin;\n","import PouchDB from 'pouchdb';\nimport PouchFind from 'pouchdb-find';\n\nPouchDB.plugin(PouchFind);\n\nexport function db(name, options) {\n    return new PouchDB(name, options);\n}\n\nexport function execute(method, key, ...args) {\n    if(Array.isArray(key)) {\n        const promises = key.map(key => method(key).then(data => {\n            return [key, data];\n        }, () => {\n            return [key, undefined];\n        }));\n\n        return Promise.all(promises).then(data => {\n            return data.reduce((carry, [key, data]) => {\n                return Object.assign({[key]: data }, carry);\n            }, {});\n        });\n    }\n    else {\n        return method(key, ...args);\n    }\n}\n\nexport function promise(data) {\n    if(data instanceof Promise) {\n        return data;\n    }\n\n    if(typeof data === 'function') {\n        return promise(data());\n    }\n\n    return Promise.resolve(data);\n}\n\nexport function id(doc) {\n    return doc && doc._id || doc;\n}\n\nexport function isJson(data) {\n    if(data instanceof Promise) {\n        return false;\n    }\n\n    try {\n        return typeof JSON.parse(JSON.stringify(data)) === 'object';\n    }\n    catch(e) {\n        return false;\n    }\n}\n\nexport function find(...args) {\n    return global.find(...args);\n}\n\nexport function findKey(key, ...args) {\n    return find({\n        selector: {\n            $or: [{\n                _id: key\n            }].concat([findCacheSelector(key)])\n        }\n    }, ...args);\n}\n\nexport function findFirstKey(key, ...args) {\n    return findKey(key, ...args).then(({ docs }) => docs.slice(0, 1).pop());\n}\n\nexport function firstOrFail(key, ...args) {\n    return new Promise((resolve, reject) => {\n        findFirstKey(key).then(doc => {\n            execute(global.get, doc ? doc._id : key, ...args).then(resolve, reject);\n        });\n    });\n}\n\nexport function findConfig(key, ...args) {\n    return get(key, ...args).then(({ data }) => data, () => undefined);\n}\n\nexport function findCache(key, ...args) {\n    return findConfig(key, ...args);\n}\n\nexport function config(key, data, ...args) {\n    if(typeof data === 'undefined') {\n        return execute(findConfig, key, ...args);\n    }\n    \n    return new Promise((resolve, reject) => {\n        promise(data).then(data => {\n            save(key, { data }).then(({ data }) => resolve(data), e => resolve());\n        });\n    });\n}\n\nexport function get(key, ...args) {\n    return execute(firstOrFail, key, ...args);\n}\n\nexport function post(doc, ...args) {\n    doc = JSON.parse(JSON.stringify(doc));\n    \n    return new Promise((resolve, reject) => {\n        execute(global.post, doc, ...args).then(({ id }) => {\n            get(id).then(resolve, reject);\n        }, reject);\n    });\n}\n\nexport function put(doc, ...args) {\n    const { _id } = doc;\n    \n    doc = JSON.parse(JSON.stringify(doc));\n\n    return new Promise((resolve, reject) => {\n        get(_id).then(({ _rev }) => {\n            execute(global.put, Object.assign(doc, { _rev })).then(() => resolve(doc), reject);\n        }, reject);\n    });\n}\n\nexport function remove(key, ...args) {\n    if(typeof key === 'object') {\n        return execute(global.remove, key, ...args);\n    }\n\n    return new Promise((resolve, reject) => {\n        get(key).then(doc => {\n            remove(doc).then(resolve, reject);\n        }, () => resolve());\n    });\n}\n\nexport function save(doc, data, ...args) {\n    if(Array.isArray(doc)) {\n        return execute(save, doc, data, ...args);    \n    }\n\n    if(!isJson(doc) && !isJson(data) || typeof data === 'object' && !Object.keys(data).length) {\n        return config(doc, data, ...args);\n    }\n    \n    if(typeof doc === 'string') {\n        doc = Object.assign({_id: doc}, data);\n    }\n\n    if(!doc._id) {\n        return post(doc);\n    }\n\n    return new Promise((resolve, reject) => {\n        retryUntilSucceeds(() => {\n            return get(doc._id).then(({ _rev }) => {\n                return put(Object.assign(doc, { _rev }));\n            }, () => {\n                return post(doc);\n            });\n        }).then(resolve, reject);\n    });\n}\n\n/*\nexport function retryUntilWritten(name, saveData, options, fn) {\n    if(options instanceof Function) {\n        fn = options;\n    }\n\n    if(typeof options !== 'object') {\n        options = {};\n    }\n\n    if(!saveData._id && saveData.id) {\n        saveData._id = saveData.id.toString();\n    }\n\n    function write(data) {\n        return db(name).put(saveData).catch(err => {\n            if (err.status === 409) {\n                return retryUntilWritten(name, saveData, options, fn);\n            }\n            else {\n                return db(name).put(saveData);\n            }\n        });\n    }\n\n    return db(name)\n        .get(saveData._id, options)\n        .then(currentDoc => {\n            saveData._rev = currentDoc._rev;\n            saveData = fn instanceof Function ? fn(saveData, currentDoc) : saveData;\n\n            return write(saveData);\n        }, e => {\n            return write(saveData);\n        });\n}\n*/\n\nexport function findCacheSelector(key) {\n    return {\n        key,\n        $cache: { $exists: true },\n        $or: [{\n            $expiredAt: { $eq: null },\n        }, {\n            $expiredAt: { $gt: new Date().getTime() },\n        }]\n    };\n}\n\nexport function purge(key, ...args) {\n    return remove(key, ...args);\n}\n\nexport function retryUntilSucceeds(method, ...args) {\n    return promise(method(...args)).catch(e => {\n        if(e.status === 409) {\n            return retryUntilSucceeds(method, ...args);\n        }\n\n        throw e;\n    });\n}\n\nexport function clearExpiredAt(key) {\n    return new Promise((resolve, reject) => {\n        find({\n            selector: {\n                _id: key,\n                $or: [{\n                    $expiredAt: { $exists: false }\n                },{\n                    $and: [{\n                        $expiredAt: { $exists: true }\n                    }, {\n                        $expiredAt: { $type : 'number' }\n                    }, {\n                        $expiredAt: { $lte: new Date().getTime() }\n                    }]\n                }]\n            }\n        }).then(({ docs }) => {\n            Promise.all(docs.map(doc => {\n                return retryUntilSucceeds(remove, doc);\n            })).then(resolve, reject);\n        }, reject);\n    });\n}\n\nexport function cache(key, data, length = null) {\n    if(typeof key === 'undefined') {\n        throw Error('cache() requires passing at least one key.');\n    }\n\n    if(typeof data === 'undefined') {\n        return execute(findCache, key);\n    }\n\n    if(data === null) {\n        return execute(purge, key);\n    }\n    \n    return new Promise((resolve, reject) => {\n        const $expiredAt = typeof length === 'number' && new Date().getTime() + length * 1000 || null;\n\n        clearExpiredAt(key).then(() => {\n            get(key).then(({ data }) => resolve(data), () => {\n                promise(data).then(data => {\n                    save(key, {\n                        data,\n                        $expiredAt,\n                        $cache: true,\n                        $cachedAt: new Date().getTime()\n                    }).then(({ data }) => resolve(data), reject);\n                }, reject);\n            });\n        }, reject);\n    });\n}\n\nconst global = db(process.env.VUE_APP_DB_NAME || 'capsule');\n\nexport default global;","import deepExtend from 'deep-extend';\nimport { get, save } from './Storage';\n\nfunction value(val, ...args) {\n    return typeof val === 'function' ? val(...args) : val;\n}\n\nfunction promise(val, ...args) {\n    val = value(val, ...args);\n\n    if(val instanceof Promise) {\n        return val;\n    }\n\n    return Promise.resolve(val);\n}\n\n// TODO: Create a file for an encryption when app first launches...\nexport default (options = {}) => {\n    const key = options.key || 'config';\n\n    const DEFAULT_DRIVER = vuex => ({\n        initialize() {\n            return promise(this.state).then(state => {\n                save(key, deepExtend(vuex.state, state)).then(state => {\n                    vuex.watch(this.watch, this.set, {\n                        deep: true\n                    });\n        \n                    vuex.replaceState(state);\n                });\n            });\n        },\n        watch(state) {\n            return state;\n        },\n        set(value) {\n            save(key, value);\n        },\n        state() {\n            return get(key).then(null, e => null);\n        },\n        resetStateToDefault() {\n            //\n        }\n    });\n    \n    return vuex => {\n        const driver = Object.assign(\n            value(DEFAULT_DRIVER, vuex),\n            value(options.driver, vuex)\n        );\n\n        driver.initialize().then(options.initialized);\n    };\n};\n"],"sourceRoot":""}