{"version":3,"sources":["webpack://vuex-persistent-plugin/webpack/universalModuleDefinition","webpack://vuex-persistent-plugin/webpack/bootstrap","webpack://vuex-persistent-plugin/./node_modules/pouchdb-binary-utils/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-md5/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/base64-js/index.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb/node_modules/uuid/lib/rng-browser.js","webpack://vuex-persistent-plugin/./node_modules/deep-extend/lib/deep-extend.js","webpack://vuex-persistent-plugin/./node_modules/inherits/inherits_browser.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-errors/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-fetch/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-collections/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-collate/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-utils/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-mapreduce-utils/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-abstract-mapreduce/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-selector-core/lib/index.es.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-find/lib/index-browser.es.js","webpack://vuex-persistent-plugin/./node_modules/spark-md5/spark-md5.js","webpack://vuex-persistent-plugin/./node_modules/vuvuzela/index.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb/node_modules/uuid/index.js","webpack://vuex-persistent-plugin/./node_modules/ieee754/index.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-utils/node_modules/uuid/v1.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb/node_modules/uuid/v1.js","webpack://vuex-persistent-plugin/./node_modules/buffer/index.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb/node_modules/uuid/v4.js","webpack://vuex-persistent-plugin/(webpack)/buildin/global.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb/node_modules/uuid/lib/bytesToUuid.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-utils/node_modules/uuid/lib/bytesToUuid.js","webpack://vuex-persistent-plugin/./node_modules/argsarray/index.js","webpack://vuex-persistent-plugin/./node_modules/immediate/lib/browser.js","webpack://vuex-persistent-plugin/./node_modules/isarray/index.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-utils/node_modules/uuid/index.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-utils/node_modules/uuid/v4.js","webpack://vuex-persistent-plugin/./node_modules/process/browser.js","webpack://vuex-persistent-plugin/./node_modules/current-script-polyfill/currentScript.js","webpack://vuex-persistent-plugin/./node_modules/pouchdb-utils/node_modules/uuid/lib/rng-browser.js","webpack://vuex-persistent-plugin/./node_modules/events/events.js","webpack://vuex-persistent-plugin/./node_modules/@vue/cli-service/lib/commands/build/setPublicPath.js","webpack://vuex-persistent-plugin/./src/Storage.js","webpack://vuex-persistent-plugin/./src/persistent.js","webpack://vuex-persistent-plugin/./node_modules/@vue/cli-service/lib/commands/build/entry-lib-no-default.js"],"names":["root","factory","exports","module","define","amd","self","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","thisAtob","str","atob","thisBtoa","btoa","createBlob","parts","properties","Blob","e","Builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","builder","length","append","getBlob","type","binaryStringToArrayBuffer","bin","buf","ArrayBuffer","arr","Uint8Array","charCodeAt","binStringToBluffer","binString","b64ToBluffer","b64","readAsArrayBuffer","blob","callback","reader","FileReader","onloadend","result","target","ExportedSet","ExportedMap","mangle","unmangle","substring","Map$1","_store","Set$1","array","Array","isArray","len","add","supportsMapAndSet","Map","Set","prop","getOwnPropertyDescriptor","species","isBinaryObject","cloneArrayBuffer","buff","slice","byteLength","targetArray","sourceArray","set","cloneBinaryObject","size","webkitSlice","mangled","has","delete","res","forEach","cb","keys","funcToString","Function","toString","objectCtorString","isPlainObject","proto","getPrototypeOf","Ctor","constructor","clone","newObject","Date","toISOString","once","fun","called","args","Error","apply","toPromise","func","usedCB","pop","promise","Promise","fulfill","reject","resp","err","mesg","push","then","logApiCall","listeners","logArgs","emit","origCallback","responseArgs","concat","adapterFun","_closed","_destroyed","taskqueue","isReady","addTask","failed","pick","obj","hasLocal","assign","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","x","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","request","id","numDocs","numDone","perDocResults","collapseResultsAndFinish","results","info","checkDone","gotResult","docIndex","allRequests","nextBatch","upTo","Math","min","batch","processBatch","offset","docId","j","docIdx","docRequests","docOpts","open_revs","map","rev","filter","formatResult","param","error","localStorage","setItem","getItem","hasLocalStorage","attachBrowserEvents","addEventListener","Changes","_listeners","guardedConsole","method","console","arguments","randomNumber","max","maxTimeout","parseInt","ratio","random","range","defaultBackOff","explainError","status","addListener","dbName","inprogress","eventFunction","on","changesOpts","changes","seq","since","cancelled","onChange","onError","removeListener","notifyLocalWindows","notify","to","index","nextSource","nextKey","$inject_Object_assign","PouchError","reason","message","JSON","stringify","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","UNKNOWN_ERROR","BAD_ARG","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","IDB_ERROR","INVALID_REV","MISSING_STUB","createError","CustomPouchError","undefined","generateErrorFromResponse","data","tryFilter","doc","req","msg","filterChange","hasFilter","query","query_params","change","filterReturn","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","test","isRemote","_remote","listenerCount","ee","parseDesignDocFunctionName","split","normalizeDesignDocFunctionName","normalized","join","qName","qParser","parser","parseUri","exec","uri","encoded","indexOf","decodeURIComponent","replace","$0","$1","$2","scopeEval","source","scope","values","upsert","diffFun","docRev","_rev","newDoc","updated","_id","tryAndPut","put","arrayBufferToBinaryString","buffer","binary","bytes","String","fromCharCode","readAsBinaryString","hasBinaryString","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","global","setImmediate","setTimeout","MD5_CHUNK_SIZE","rawToBase64","raw","sliceBlob","start","end","appendBlob","arrayBuffer","appendString","string","appendBinary","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","next","loadNextChunk","done","destroy","stringMd5","hash","deterministic_revs","clonedDoc","_rev_tree","v4","toLowerCase","uuid","winningRev","metadata","winningId","winningPos","winningDeleted","node","toVisit","rev_tree","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","ctx","sortByPos","a","b","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","compactTree","revHash","rootToLeaf","paths","history","sortByPos$1","binarySearch","item","comparator","mid","low","high","insertSorted","idx","splice","pathToTree","path","numStemmed","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","queue","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parent","parentIdx","elements","elementsLen","el","stem","depth","stemmedRevs","stemmed","merge","newTree","revExists","splitRev","targetPos","targetId","getTrees","isDeleted","isLocalId","latest","historyNode","historyRev","tryCatchInChangeListener","pending","lastSeq","Changes$1","complete","removeAllListeners","onDestroy","cancel","isCancelled","validateChanges","processChange","changeList","style","_conflicts","compare","left","right","yankError","cleanDocs","_deleted","atts","compareByIdThenRev","idCompare","aStart","_revisions","bStart","computeHeight","height","edges","prnt","rev$$1","from","edge","allDocsKeysParse","skip","limit","descending","doNextCompaction","task","_compactionQueue","catch","last_seq","_compact","shift","attachmentNameError","charAt","AbstractPouchDB","TaskQueue","parseAdapter","match","adapter","adapters","PouchDB","preferredAdapters","prefix","adapterName","usePrefix","use_prefix","prepareForDestruction","onDestroyed","from_constructor","onClosed","__opts","auto_compaction","prefixedName","backend","_adapter","valid","fail","ready","_changesFilterPlugin","validate","doChanges","continuous","live","normalize","shouldFilter","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_removeLocal","transformForceOptionToNewEditsOption","oldRevId","oldRevNum","newRevNum","newRevId","new_edits","putDoc","_put","force","putAttachment","attachmentId","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","remove","docOrId","optsOrRev","was_delete","revsDiff","count","missing","addToMissing","revId","processDoc","missingForId","_getRevisionTree","missingObj","compactDocument","maxHeight","revTree","candidates","_doCompaction","compact","return_docs","promises","row","onComplete","all","_getLocal","finishOpenRevs","existing","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","hashFoundAtRevPos","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","start_key","startkey","end_key","endkey","TypeError","incompatibleOpt","_allDocs","close","_close","_info","db_name","_type","attachmentError","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","destroyDb","_destroy","localDoc","deletedMap","trueName","RegExp","execute","AbortController","abort","f$1","fetch","h","Headers","eventEmitter","setUpEventEmitter","Pouch","destructListeners","_destructionListeners","dbList","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","url","version","getFieldFromDoc","parsedField","compare$1","parseField","fieldName","fields","current","ch","combinationFields","isCombinationalField","field","getKey","getValue","mergeAndedSelectors","selectors","selector","matcher","$eq","fieldMatchers","operator","mergeGtGte","mergeLtLte","mergeNe","mergeEq","$gte","$gt","$lte","$lt","$ne","mergeAndedSelectorsNested","isAndInSelector","isAnd","massageSelector","input","wasAnded","orOrNor","subSelector","pad","padWith","upToLength","padding","targetLength","padLeft","MIN_MAGNITUDE","MAGNITUDE_DIGITS","SEP","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","objectCollate","Infinity","isNaN","origKey","toJSON","k","val","indexify","numToIndexableString","toIndexableString","objKey","zero","parseNumber","num","originalIdx","neg","numAsString","magAsString","magnitude","parseFloat","stack","metaStack","lastMetaElement","element","lastElementIndex","parseIndexableString","parsedNum","parsedStr","arrayElement","objElement","ak","bk","expFormat","toExponential","magForComparison","magString","factor","abs","factorStr","toFixed","createFieldSorter","getFieldValuesAsArray","sorting","docFieldValue","aRow","bRow","aFieldValues","bFieldValues","collation","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","every","matchCominationalSelector","matchSelector","userOperator","userValue","some","orMatchers","find","matchers","fieldExists","fieldIsNotUndefined","modField","divisor","mod","arrayContainsValue","arrayContainsAllValues","arraySize","regexMatch","re","typeMatch","neValue","matchesSelector","rowsMatched","evalFilter","evalView","code","filterName","view","changesHandler","doc_ids","viewName","ddoc","mapFun","views","filterFun","filters","applyChangesFilterPlugin","toObject","reduce","reservedWords","dataWords","parseRevisionInfo","makeRevTreeFromRevisions","revisions","revisionIds","parseDoc","newEdits","dbOpts","nRevNum","revInfo","specialKey","parseBase64","preprocessString","blobType","asBinary","digest","preprocessBlob","md5","preprocessAttachment","preprocessAttachments","docInfos","overallErr","docv","docInfo","recv","processedAttachment","updateDoc","revLimit","prev","writeDoc","previousWinningRev","previouslyDeleted","isRoot","inConflict","newRev","rev_map","newRevIsDeleted","winningRev$$1","winningRevIsDeleted","delta","rootIsMissing","processDocs","fetchedDocs","tx","overallCallback","insertDoc","resultsIdx","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","docWritten","nextDoc","ADAPTER_VERSION","DOC_STORE","BY_SEQ_STORE","ATTACH_STORE","ATTACH_AND_SEQ_STORE","META_STORE","LOCAL_STORE","DETECT_BLOB_SUPPORT_STORE","safeJsonParse","parse","safeJsonStringify","json","idbError","evt","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","decodeDoc","_doc_id_rev","lastIndexOf","readBlobData","body","asBlob","fetchAttachmentsIfNecessary","txn","fetchAttachment","attObj","objectStore","onsuccess","postProcessAttachments","attNames","resolve","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","deleteOrphanedAttachments","countReq","IDBKeyRange","bound","cursor","openCursor","only","event","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","startTransaction","txnResult","onabort","ontimeout","oncomplete","updateDocCountIfReady","verifyAttachments","fetchExistingDocs","onAllDocsProcessed","idbProcessDocs","revs_limit","docCount","numFetched","readMetadata","verifyAttachment","finish","digests","filename","attErr","isUpdate","hasAttachments","writeAttachments","finishDoc","afterPutDoc","revsToDelete","metadataToStore","metaDataReq","afterPutMetadata","afterPutDocError","preventDefault","stopPropagation","getKeyReq","putReq","insertAttachmentMappings","onerror","collectResults","attachmentSaved","saveAttachment","attsAdded","attsToAdd","newAtt","runBatchedCursor","keyRange","batchSize","onBatch","keysBatch","valuesBatch","pseudoCursor","useGetAll","getAll","getAllKeys","onGetAll","onGetAllKeys","continuePseudoCursor","newKeyRange","lastKey","upper","upperOpen","lowerBound","onCursor","onSuccess","allDocsKeys","createKeyRange","inclusiveEnd","upperBound","idbAllDocs","keyRangeError","inclusive_end","onTxnComplete","updateSeq","docIdRevIndex","getMaxUpdateSeq","maxKey","fetchDocAsynchronously","allDocsInner","batchValues","batchValue","batchKeys","onResultsReady","returnVal","total_rows","checkBlobSupport","blob$$1","matchedChrome","navigator","userAgent","matchedEdge","countDocs","running","tryCode","applyNext","enqueueTask","action","docIds","numResults","docIdsToMetadata","winningDocs","metadatas","fetchWinningDocAndMetadata","winningDoc","onBatchDone","processMetadataAndWinningDoc","filtered","onGetMetadata","docIdRev","objectStores","blobSupportPromise","cachedDBs","openReqList","IdbPouch","thisCallback","init","createSchema","createObjectStore","keyPath","autoIncrement","createIndex","unique","addDeletedOrLocalIndex","createLocalStoreSchema","migrateLocalStore","localStore","local","seqCursor","addAttachAndSeqStore","migrateAttsAndSeqs","digestMap","migrateMetadata","decodeMetadataCompat","onGetMetadataSeq","fetchMetadataSeq","metadataSeq","instanceId","reqOpts","attachId","attachment","blobData","doc_count","idb_attachment_format","oldRev","ret","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","currentTarget","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","IDBPouch","pool","promiseFactories","runNext","doNext","runNextBatch","thisErr","CHANGES_BATCH_SIZE","MAX_SIMULTANEOUS_REVS","CHANGES_TIMEOUT_BUFFER","DEFAULT_HEARTBEAT","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","encodeURIComponent","preprocessAttachments$1","hasUrlPrefix","protocol","getHost","substr","user","password","auth","username","genDBUrl","genUrl","pathDel","host","port","paramsToStr","params","shouldCacheBust","ua","isIE","isTrident","isEdge","isGET","HttpPouch","dbUrl","setupPromise","ourFetch","options","headers","credentials","nAuth","token","unescape","now","fetchFun","adapterFun$$1","setup","fetchJSON","response","v","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","fetchData","process","browser","fetchAllAttachments","docOrDocs","contentType","paramStr","batch_size","heartbeat","requestTimeout","timeout","leftToFetch","feed","seq_interval","param_name","lastFetchedSeq","controller","aborted","fetchOpts","signal","fetched","raw_results_length","finished","HttpPouch$1","QueryParseError","captureStackTrace","NotFoundError","BuiltInError","promisedCallback","callbackify","fin","finalPromiseFactory","sequentialize","promiseFactory","that","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createViewSignature","reduceFun","createView","sourceDB","temporary","localDocName","cachedViews","viewSignature","_cachedViews","promiseForView","depDbName","diffFunction","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","CHANGES_BATCH_SIZE$1","parseViewName","isGenOne","emitError","createAbstractMapReduce","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","y","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","Number","coerceOptions","group_level","checkPositiveInteger","number","checkQueryParseError","startkeyName","endkeyName","group","optionName","httpQuery","MAX_URL_LENGTH","keysAsString","customQuery","_query","customViewCleanup","_viewCleanup","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","getMetaDoc","getKeyValueDocs","processKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","saveKeyValues","seqDocId","listOfDocsToPersist","docsToPersist","getQueue","updateView","updateViewInQueue","mapResults","currentSeq","processNextBatch","createDocIdsToChangesAndEmits","createIndexableKeysToKeyValues","emittedKeyValue","complexKey","reduceView","shouldGroup","groups","lvl","POSITIVE_INFINITY","last","groupKey","reduceTry","queryView","queryViewInQueue","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","onMapResultsReady","finalResults","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","httpViewCleanup","localViewCleanup","docsToViews","designDocName","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","dbsToDelete","destroyPromises","queryPromised","createViewPromise","stale","abstractQuery","abstractViewCleanup","viewCleanup","builtInReduce","_sum","_count","_stats","sumsqr","_sumsqr","getBuiltIn","reduceFunString","origMap","builtIn","abstract","mapreduce","isGenOne$1","fileHasChanged","remoteDoc","getDocAttachments","getDocAttachmentsFromTargetOrSource","src","doCheckForLocalAttachments","createBulkGetOpts","diffs","missingRevs","missingRev","getDocs","state","resultDocs","getAllDocs","bulkGetOpts","bulkGetResponse","bulkGetInfo","Boolean","hasConflicts","fetchRevisionOneDocs","getRevisionOneDocs","returnResult","CHECKPOINT_VERSION","REPLICATOR","CHECKPOINT_HISTORY_SIZE","LOWEST_SEQ","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","unshift","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","compareReplicationLogs","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","sourceId","hasSessionId","sessionId","props","rest","floor","getCheckpoint","STARTING_BACK_OFF","backOff","retry","back_off_function","backOffSet","current_back_off","removeBackOffSetter","sortObjectPropertiesByKey","queryParams","generateReplicationId","filterViewName","queryData","md5sum","replicate","currentBatch","repId","checkpointer","batches","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","start_time","docs_read","docs_written","doc_write_failures","errors","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getDiffs","getBatchDocs","got","startNextBatch","abortReplication","processPendingBatch","immediate$$1","fatalError","end_time","onChangesComplete","onChangesError","_abortChanges","abortChanges","startChanges","_addedListeners","Replication","toPouch","PouchConstructor","replicateWrapper","replicateRet","srcPouch","targetPouch","sync","Sync","canceled","optsPush","optsPull","pull","pullChange","direction","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","isChange","isDenied","isPaused","isActive","addOneListener","listener","out","success","replication","replicateMethods","other","cleanup","_readyCalled","toByteArray","fromByteArray","lookup","revLookup","Arr","getLens","validLen","placeHoldersLen","lens","_byteLength","tmp","curByte","tripletToBase64","encodeChunk","uint8","extraBytes","maxChunkLength","len2","getRandomValues","crypto","msCrypto","rnds8","rnds","isSpecificValue","Buffer","cloneSpecificValue","alloc","copy","getTime","deepCloneArray","deepExtend","safeGetProperty","ctor","superCtor","super_","writable","configurable","TempCtor","assign$1","hasName","setFieldInDoc","elem","massageCreateIndexRequest","dbFetch","getIndexes","deleteIndex","indexDef","getArguments","subArr","mergeObjects","oneArrayIsSubArrayOfOther","oneArrayIsStrictSubArrayOfOther","oneSetIsSubArrayOfOther","leftIdx","arrayToObject","maxScore","score","arrayEquals","arr1","arr2","createDeepMultiMapper","toEmit","iLen","createDeepSingleMapper","createShallowSingleMapper","createShallowMultiMapper","checkShallow","createMapper","isShallow","isSingle","mapFunDef","abstractMapper","abstractMapper$1","_customFindAbstractMapper","massageSort","massageUseIndex","useIndex","cleanedUseIndex","massageIndexDef","getKeyFromDoc","def","filterInclusiveStart","targetValue","indexFields","docKey","reverseOptions","newOpts","inclusive_start","validateIndex","ascFields","validateSort","defaultUsed","noneIdSorts","sortItem","validateFindRequest","getUserFields","userFields","selectorFields","sortFields","MAX_VALUE","rightIdx","sortOrder","createIndex$1","originalIndexDef","getMd5","ddocId","hasInvalidLanguage","viewExists","updateDdoc","language","signature","getIndexes$1","indexes","viewNames","COLLATE_LO","COLLATE_HI","checkFieldInIndex","indexField","userOperatorLosesPrecision","sortFieldsByIndex","aIdx","bIdx","getBasicInMemoryFields","needToFilterInMemory","getInMemoryFieldsFromNe","getInMemoryFields","coreInMemoryFields","checkIndexFieldsMatch","sortMatches","selectorMatches","logicalMatchers","isNonLogicalMatcher","checkFieldsLogicallySound","firstField","isInvalidNe","checkIndexMatches","fieldsMatch","findMatchingIndexes","indexMatches","findBestMatchingIndex","matchingIndexes","defaultIndex","userFieldsMap","scoreIndex","useIndexDdoc","useIndexName","getSingleFieldQueryOptsFor","getSingleFieldCoreQueryPlan","combinedOpts","userOperators","newQueryOpts","queryOpts","getMultiFieldCoreQueryPlan","getMultiFieldQueryOpts","inclusiveStart","usingGtlt","previousKeys","previousWasEq","previousWasSame","gtltLostSpecificity","getDefaultQueryPlan","getCoreQueryPlan","planQuery","userFieldsRes","use_index","coreQueryPlan","indexToSignature","doAllDocs","originalOpts","find$1","explain","getIndexesRes","queryPlan","indexToUse","isDescending","warning","explain$1","dbname","bookmark","deleteIndex$1","deltaFun","createIndexAsCallback","findAsCallback","explainAsCallback","getIndexesAsCallback","deleteIndexAsCallback","createIndex$$1","find$$1","getIndexes$$1","deleteIndex$$1","hex_chr","md5cycle","md5blk","md5blks","md5blk_array","md51","tail","lo","hi","md51_array","subarray","rhex","hex","toUtf8","utf8Str2ArrayBuffer","returnUInt8Array","arrayBuffer2Utf8Str","concatenateArrayBuffers","first","second","hexToBinaryString","SparkMD5","reset","lsw","msw","clamp","begin","contents","_buff","_length","_hash","_finish","getState","setState","hashBinary","content","arrayPrefix","objPrefix","numChar","parsedString","lastCh","numConsecutiveSlashes","v1","read","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","pow","write","rt","LN2","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","clockseq","seedBytes","msecs","nsecs","dt","tl","tmh","ieee754","typedArraySupport","__proto__","foo","kMaxLength","TYPED_ARRAY_SUPPORT","createBuffer","RangeError","arg","encodingOrOffset","allocUnsafe","fromArrayBuffer","fromString","fromObject","assertSize","fill","encoding","checked","isEncoding","actual","fromArrayLike","byteOffset","isBuffer","isnan","SlowBuffer","isView","loweredCase","utf8ToBytes","base64ToBytes","slowToString","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","swap","bidirectionalIndexOf","dir","arrayIndexOf","indexSize","arrLength","valLength","readUInt16BE","foundIndex","found","hexWrite","remaining","strLen","parsed","utf8Write","blitBuffer","asciiWrite","asciiToBytes","latin1Write","base64Write","ucs2Write","utf16leToBytes","secondByte","thirdByte","fourthByte","tempCodePoint","firstByte","codePoint","bytesPerSequence","decodeCodePointsArray","INSPECT_MAX_BYTES","poolSize","_augment","allocUnsafeSlow","_isBuffer","list","swap16","swap32","swap64","equals","inspect","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","_arr","MAX_ARGUMENTS_LENGTH","codePoints","toHex","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","writeDouble","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","maxBytes","writeUIntBE","writeUInt8","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","INVALID_BASE64_RE","base64clean","stringtrim","trim","units","leadSurrogate","byteArray","dst","ii","g","window","byteToHex","bth","argsArray","scheduleDrain","draining","Mutation","MutationObserver","WebKitMutationObserver","observer","nextTick","document","createTextNode","observe","characterData","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","channel","port1","onmessage","port2","postMessage","oldQueue","immediate","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","runClearTimeout","marker","clearTimeout","currentQueue","queueIndex","cleanUpNextTick","drainQueue","run","Item","noop","title","env","argv","versions","off","prependListener","prependOnceListener","binding","cwd","chdir","umask","currentScript","scripts","getElementsByTagName","readyState","ReflectOwnKeys","R","Reflect","ReflectApply","receiver","ProcessEmitWarning","warn","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","NumberIsNaN","EventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","$getMaxListeners","_addListener","prepend","events","newListener","warned","w","emitter","onceWrapper","fired","wrapFn","_onceWrap","wrapped","unwrap","evlistener","unwrapListeners","arrayClone","spliceOne","setMaxListeners","getMaxListeners","doError","er","context","handler","position","originalListener","rawListeners","eventNames","require","default","VUE_APP_DB_NAME","carry","isJson","findKey","$or","findCacheSelector","findFirstKey","firstOrFail","findConfig","config","save","$cache","$exists","$expiredAt","DEFAULT_DRIVER","vuex","initialize","watch","deep","replaceState","resetStateToDefault","driver"],"mappings":"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AAI2L,GAAU,EACdgqD,EAAMD,EACV,OAAOC,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MACvB21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAAQ,IAChC21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAAQ,IAChC21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAAQ,IAChC21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAAQ,IAChC21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MACxB21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MACxB21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAGlCR,EAAOD,QAAUosD,G,mBCjBjB,IADA,IAAI+J,EAAY,GACP11D,EAAI,EAAGA,EAAI,MAAOA,EACzB01D,EAAU11D,IAAMA,EAAI,KAAO8G,SAAS,IAAI88B,OAAO,GAGjD,SAAS+nB,EAAYroD,EAAKqI,GACxB,IAAI3L,EAAI2L,GAAU,EACdgqD,EAAMD,EACV,OAAOC,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MACvB21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAAQ,IAChC21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAAQ,IAChC21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAAQ,IAChC21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAAQ,IAChC21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MACxB21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MACxB21D,EAAIryD,EAAItD,MAAQ21D,EAAIryD,EAAItD,MAGlCR,EAAOD,QAAUosD,G,kCClBjB,SAASiK,EAAUluD,GACjB,OAAO,WACL,IAAIxC,EAAMiI,UAAUnK,OACpB,GAAIkC,EAAK,CACP,IAAI0C,EAAO,GACP5H,GAAK,EACT,QAASA,EAAIkF,EACX0C,EAAK5H,GAAKmN,UAAUnN,GAEt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","file":"vuex-persistent-plugin.umd.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"vuex-persistent-plugin\"] = factory();\n\telse\n\t\troot[\"vuex-persistent-plugin\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"fae3\");\n","var thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\nfunction typedBuffer() {\n}\n\nexport { thisAtob as atob, thisBtoa as btoa, b64ToBluffer as base64StringToBlobOrBuffer, binaryStringToArrayBuffer, binStringToBluffer as binaryStringToBlobOrBuffer, createBlob as blob, blobToBase64 as blobOrBufferToBase64, blobToBinaryString as blobOrBufferToBinaryString, readAsArrayBuffer, readAsBinaryString, typedBuffer };\n","import immediate from 'immediate';\nimport uuidV4 from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport { EventEmitter } from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.1.1\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-./.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending  no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function () {\n    var msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if (typeof process !== 'undefined' && !process.browser) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            // TODO: Can we remove this?\n            if (typeof process !== 'undefined' && !process.browser) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser) {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n    \n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","import { btoa, readAsArrayBuffer } from 'pouchdb-binary-utils';\nimport Md5 from 'spark-md5';\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return btoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nexport { binaryMd5, stringMd5 };\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(\n      uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)\n    ))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/*!\n * @description Recursive object extending\n * @author Viacheslav Lotsmanov <lotsmanov89@gmail.com>\n * @license MIT\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2013-2018 Viacheslav Lotsmanov\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n * the Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n'use strict';\n\nfunction isSpecificValue(val) {\n\treturn (\n\t\tval instanceof Buffer\n\t\t|| val instanceof Date\n\t\t|| val instanceof RegExp\n\t) ? true : false;\n}\n\nfunction cloneSpecificValue(val) {\n\tif (val instanceof Buffer) {\n\t\tvar x = Buffer.alloc\n\t\t\t? Buffer.alloc(val.length)\n\t\t\t: new Buffer(val.length);\n\t\tval.copy(x);\n\t\treturn x;\n\t} else if (val instanceof Date) {\n\t\treturn new Date(val.getTime());\n\t} else if (val instanceof RegExp) {\n\t\treturn new RegExp(val);\n\t} else {\n\t\tthrow new Error('Unexpected situation');\n\t}\n}\n\n/**\n * Recursive cloning array.\n */\nfunction deepCloneArray(arr) {\n\tvar clone = [];\n\tarr.forEach(function (item, index) {\n\t\tif (typeof item === 'object' && item !== null) {\n\t\t\tif (Array.isArray(item)) {\n\t\t\t\tclone[index] = deepCloneArray(item);\n\t\t\t} else if (isSpecificValue(item)) {\n\t\t\t\tclone[index] = cloneSpecificValue(item);\n\t\t\t} else {\n\t\t\t\tclone[index] = deepExtend({}, item);\n\t\t\t}\n\t\t} else {\n\t\t\tclone[index] = item;\n\t\t}\n\t});\n\treturn clone;\n}\n\nfunction safeGetProperty(object, property) {\n\treturn property === '__proto__' ? undefined : object[property];\n}\n\n/**\n * Extening object that entered in first argument.\n *\n * Returns extended object or false if have no target object or incorrect type.\n *\n * If you wish to clone source object (without modify it), just use empty new\n * object as first argument, like this:\n *   deepExtend({}, yourObj_1, [yourObj_N]);\n */\nvar deepExtend = module.exports = function (/*obj_1, [obj_2], [obj_N]*/) {\n\tif (arguments.length < 1 || typeof arguments[0] !== 'object') {\n\t\treturn false;\n\t}\n\n\tif (arguments.length < 2) {\n\t\treturn arguments[0];\n\t}\n\n\tvar target = arguments[0];\n\n\t// convert arguments to array and cut off target object\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tvar val, src, clone;\n\n\targs.forEach(function (obj) {\n\t\t// skip argument if isn't an object, is null, or is an array\n\t\tif (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n\t\t\treturn;\n\t\t}\n\n\t\tObject.keys(obj).forEach(function (key) {\n\t\t\tsrc = safeGetProperty(target, key); // source value\n\t\t\tval = safeGetProperty(obj, key); // new value\n\n\t\t\t// recursion prevention\n\t\t\tif (val === target) {\n\t\t\t\treturn;\n\n\t\t\t/**\n\t\t\t * if new value isn't object then just overwrite by new value\n\t\t\t * instead of extending.\n\t\t\t */\n\t\t\t} else if (typeof val !== 'object' || val === null) {\n\t\t\t\ttarget[key] = val;\n\t\t\t\treturn;\n\n\t\t\t// just clone arrays (and recursive clone objects inside)\n\t\t\t} else if (Array.isArray(val)) {\n\t\t\t\ttarget[key] = deepCloneArray(val);\n\t\t\t\treturn;\n\n\t\t\t// custom cloning and overwrite for specific objects\n\t\t\t} else if (isSpecificValue(val)) {\n\t\t\t\ttarget[key] = cloneSpecificValue(val);\n\t\t\t\treturn;\n\n\t\t\t// overwrite by new value if source isn't object or array\n\t\t\t} else if (typeof src !== 'object' || src === null || Array.isArray(src)) {\n\t\t\t\ttarget[key] = deepExtend({}, val);\n\t\t\t\treturn;\n\n\t\t\t// source value and new value is objects both, extending...\n\t\t\t} else {\n\t\t\t\ttarget[key] = deepExtend(src, val);\n\t\t\t\treturn;\n\t\t\t}\n\t\t});\n\t});\n\n\treturn target;\n};\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","import inherits from 'inherits';\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nexport { UNAUTHORIZED, MISSING_BULK_DOCS, MISSING_DOC, REV_CONFLICT, INVALID_ID, MISSING_ID, RESERVED_ID, NOT_OPEN, UNKNOWN_ERROR, BAD_ARG, INVALID_REQUEST, QUERY_PARSE_ERROR, DOC_VALIDATION, BAD_REQUEST, NOT_AN_OBJECT, DB_MISSING, WSQ_ERROR, LDB_ERROR, FORBIDDEN, INVALID_REV, FILE_EXISTS, MISSING_STUB, IDB_ERROR, INVALID_URL, createError, generateErrorFromResponse };\n","// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f = fetch;\nvar h = Headers;\n\nexport { f as fetch, h as Headers, a as AbortController };\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","function pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\nexport { collate, normalizeKey, toIndexableString, parseIndexableString };\n","import getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport inherits from 'inherits';\nimport immediate from 'immediate';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport { EventEmitter } from 'events';\nimport uuidV4 from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","import { Set } from 'pouchdb-collections';\nimport argsarray from 'argsarray';\nimport { nextTick } from 'pouchdb-utils';\nimport inherits from 'inherits';\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      nextTick(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      nextTick(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return argsarray(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new Set(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nexport { uniq, sequentialize, fin, callbackify, promisedCallback, mapToKeysArray, QueryParseError, NotFoundError, BuiltInError };\n","import { Set, Map } from 'pouchdb-collections';\nimport { base64StringToBlobOrBuffer } from 'pouchdb-binary-utils';\nimport { collate, toIndexableString, normalizeKey, parseIndexableString } from 'pouchdb-collate';\nimport { generateErrorFromResponse } from 'pouchdb-errors';\nimport { Headers } from 'pouchdb-fetch';\nimport { upsert, flatten, guardedConsole, nextTick, isRemote } from 'pouchdb-utils';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { callbackify, sequentialize, uniq, fin, promisedCallback, mapToKeysArray, QueryParseError, NotFoundError, BuiltInError } from 'pouchdb-mapreduce-utils';\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue();\nvar CHANGES_BATCH_SIZE = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = base64StringToBlobOrBuffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new Headers({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new Headers({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new Set();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new Map();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new Map();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new Map();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new Headers({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new Map();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new Set();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              nextTick(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nexport default createAbstractMapReduce;\n","import { clone } from 'pouchdb-utils';\nimport { collate } from 'pouchdb-collate';\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction setFieldInDoc(doc, parsedField, value) {\n  for (var i = 0, len = parsedField.length; i < len-1; i++) {\n    var elem = parsedField[i];\n    doc = doc[elem] = {};\n  }\n  doc[parsedField[len-1]] = value;\n}\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nexport { massageSelector, matchesSelector, filterInMemoryFields, createFieldSorter, rowFilter, isCombinationalField, getKey, getValue, getFieldFromDoc, setFieldInDoc, compare, parseField };\n","import { generateErrorFromResponse } from 'pouchdb-errors';\nimport { Headers } from 'pouchdb-fetch';\nimport abstractMapReduce from 'pouchdb-abstract-mapreduce';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { collate } from 'pouchdb-collate';\nimport { getFieldFromDoc, setFieldInDoc, parseField, getKey, getValue, compare, massageSelector, filterInMemoryFields } from 'pouchdb-selector-core';\nimport { clone, assign, nextTick, upsert, toPromise, isRemote } from 'pouchdb-utils';\n\n// we restucture the supplied JSON considerably, because the official\n// Mango API is very particular about a lot of this stuff, but we like\n// to be liberal with what we accept in order to prevent mental\n// breakdowns in our users\nfunction massageCreateIndexRequest(requestDef) {\n  requestDef = clone(requestDef);\n\n  if (!requestDef.index) {\n    requestDef.index = {};\n  }\n\n  ['type', 'name', 'ddoc'].forEach(function (key) {\n    if (requestDef.index[key]) {\n      requestDef[key] = requestDef.index[key];\n      delete requestDef.index[key];\n    }\n  });\n\n  if (requestDef.fields) {\n    requestDef.index.fields = requestDef.fields;\n    delete requestDef.fields;\n  }\n\n  if (!requestDef.type) {\n    requestDef.type = 'json';\n  }\n  return requestDef;\n}\n\nfunction dbFetch(db, path, opts, callback) {\n  var status, ok;\n  opts.headers = new Headers({'Content-type': 'application/json'});\n  db.fetch(path, opts).then(function (response) {\n    status = response.status;\n    ok = response.ok;\n    return response.json();\n  }).then(function (json) {\n    if (!ok) {\n      json.status = status;\n      var err = generateErrorFromResponse(json);\n      callback(err);\n    } else {\n      callback(null, json);\n    }\n  }).catch(callback);\n}\n\nfunction createIndex(db, requestDef, callback) {\n  requestDef = massageCreateIndexRequest(requestDef);\n  dbFetch(db, '_index', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction find(db, requestDef, callback) {\n  dbFetch(db, '_find', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction explain(db, requestDef, callback) {\n  dbFetch(db, '_explain', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction getIndexes(db, callback) {\n  dbFetch(db, '_index', {\n    method: 'GET'\n  }, callback);\n}\n\nfunction deleteIndex(db, indexDef, callback) {\n\n\n  var ddoc = indexDef.ddoc;\n  var type = indexDef.type || 'json';\n  var name = indexDef.name;\n\n  if (!ddoc) {\n    return callback(new Error('you must provide an index\\'s ddoc'));\n  }\n\n  if (!name) {\n    return callback(new Error('you must provide an index\\'s name'));\n  }\n\n  var url = '_index/' + [ddoc, type, name].map(encodeURIComponent).join('/');\n\n  dbFetch(db, url, {method: 'DELETE'}, callback);\n}\n\nfunction getArguments(fun) {\n  return function () {\n    var len = arguments.length;\n    var args = new Array(len);\n    var i = -1;\n    while (++i < len) {\n      args[i] = arguments[i];\n    }\n    return fun.call(this, args);\n  };\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    promisedCallback(promise, cb);\n    return promise;\n  });\n}\n\nfunction promisedCallback(promise, callback) {\n  promise.then(function (res) {\n    nextTick(function () {\n      callback(null, res);\n    });\n  }, function (reason) {\n    nextTick(function () {\n      callback(reason);\n    });\n  });\n  return promise;\n}\n\nvar flatten = getArguments(function (args) {\n  var res = [];\n  for (var i = 0, len = args.length; i < len; i++) {\n    var subArr = args[i];\n    if (Array.isArray(subArr)) {\n      res = res.concat(flatten.apply(null, subArr));\n    } else {\n      res.push(subArr);\n    }\n  }\n  return res;\n});\n\nfunction mergeObjects(arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    res = assign(res, arr[i]);\n  }\n  return res;\n}\n\n// Selects a list of fields defined in dot notation from one doc\n// and copies them to a new doc. Like underscore _.pick but supports nesting.\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var parsedField = parseField(arr[i]);\n    var value = getFieldFromDoc(obj, parsedField);\n    if (typeof value !== 'undefined') {\n      setFieldInDoc(res, parsedField, value);\n    }\n  }\n  return res;\n}\n\n// e.g. ['a'], ['a', 'b'] is true, but ['b'], ['a', 'b'] is false\nfunction oneArrayIsSubArrayOfOther(left, right) {\n\n  for (var i = 0, len = Math.min(left.length, right.length); i < len; i++) {\n    if (left[i] !== right[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// e.g.['a', 'b', 'c'], ['a', 'b'] is false\nfunction oneArrayIsStrictSubArrayOfOther(left, right) {\n\n  if (left.length > right.length) {\n    return false;\n  }\n\n  return oneArrayIsSubArrayOfOther(left, right);\n}\n\n// same as above, but treat the left array as an unordered set\n// e.g. ['b', 'a'], ['a', 'b', 'c'] is true, but ['c'], ['a', 'b', 'c'] is false\nfunction oneSetIsSubArrayOfOther(left, right) {\n  left = left.slice();\n  for (var i = 0, len = right.length; i < len; i++) {\n    var field = right[i];\n    if (!left.length) {\n      break;\n    }\n    var leftIdx = left.indexOf(field);\n    if (leftIdx === -1) {\n      return false;\n    } else {\n      left.splice(leftIdx, 1);\n    }\n  }\n  return true;\n}\n\nfunction arrayToObject(arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    res[arr[i]] = true;\n  }\n  return res;\n}\n\nfunction max(arr, fun) {\n  var max = null;\n  var maxScore = -1;\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var element = arr[i];\n    var score = fun(element);\n    if (score > maxScore) {\n      maxScore = score;\n      max = element;\n    }\n  }\n  return max;\n}\n\nfunction arrayEquals(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (var i = 0, len = arr1.length; i < len; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction uniq(arr) {\n  var obj = {};\n  for (var i = 0; i < arr.length; i++) {\n    obj['$' + arr[i]] = true;\n  }\n  return Object.keys(obj).map(function (key) {\n    return key.substring(1);\n  });\n}\n\n//\n// One thing about these mappers:\n//\n// Per the advice of John-David Dalton (http://youtu.be/NthmeLEhDDM),\n// what you want to do in this case is optimize for the smallest possible\n// function, since that's the thing that gets run over and over again.\n//\n// This code would be a lot simpler if all the if/elses were inside\n// the function, but it would also be a lot less performant.\n//\n\n\nfunction createDeepMultiMapper(fields, emit) {\n  return function (doc) {\n    var toEmit = [];\n    for (var i = 0, iLen = fields.length; i < iLen; i++) {\n      var parsedField = parseField(fields[i]);\n      var value = doc;\n      for (var j = 0, jLen = parsedField.length; j < jLen; j++) {\n        var key = parsedField[j];\n        value = value[key];\n        if (typeof value === 'undefined') {\n          return; // don't emit\n        }\n      }\n      toEmit.push(value);\n    }\n    emit(toEmit);\n  };\n}\n\nfunction createDeepSingleMapper(field, emit) {\n  var parsedField = parseField(field);\n  return function (doc) {\n    var value = doc;\n    for (var i = 0, len = parsedField.length; i < len; i++) {\n      var key = parsedField[i];\n      value = value[key];\n      if (typeof value === 'undefined') {\n        return; // do nothing\n      }\n    }\n    emit(value);\n  };\n}\n\nfunction createShallowSingleMapper(field, emit) {\n  return function (doc) {\n    emit(doc[field]);\n  };\n}\n\nfunction createShallowMultiMapper(fields, emit) {\n  return function (doc) {\n    var toEmit = [];\n    for (var i = 0, len = fields.length; i < len; i++) {\n      toEmit.push(doc[fields[i]]);\n    }\n    emit(toEmit);\n  };\n}\n\nfunction checkShallow(fields) {\n  for (var i = 0, len = fields.length; i < len; i++) {\n    var field = fields[i];\n    if (field.indexOf('.') !== -1) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction createMapper(fields, emit) {\n  var isShallow = checkShallow(fields);\n  var isSingle = fields.length === 1;\n\n  // notice we try to optimize for the most common case,\n  // i.e. single shallow indexes\n  if (isShallow) {\n    if (isSingle) {\n      return createShallowSingleMapper(fields[0], emit);\n    } else { // multi\n      return createShallowMultiMapper(fields, emit);\n    }\n  } else { // deep\n    if (isSingle) {\n      return createDeepSingleMapper(fields[0], emit);\n    } else { // multi\n      return createDeepMultiMapper(fields, emit);\n    }\n  }\n}\n\nfunction mapper(mapFunDef, emit) {\n  // mapFunDef is a list of fields\n\n  var fields = Object.keys(mapFunDef.fields);\n\n  return createMapper(fields, emit);\n}\n\n/* istanbul ignore next */\nfunction reducer(/*reduceFunDef*/) {\n  throw new Error('reduce not supported');\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var view = ddoc.views[viewName];\n  // This doesn't actually need to be here apparently, but\n  // I feel safer keeping it.\n  /* istanbul ignore if */\n  if (!view.map || !view.map.fields) {\n    throw new Error('ddoc ' + ddoc._id +' with view ' + viewName +\n      ' doesn\\'t have map.fields defined. ' +\n      'maybe it wasn\\'t created by this plugin?');\n  }\n}\n\nvar abstractMapper = abstractMapReduce(\n  /* localDocName */ 'indexes',\n  mapper,\n  reducer,\n  ddocValidator\n);\n\nfunction abstractMapper$1 (db) {\n  return db._customFindAbstractMapper || abstractMapper;\n}\n\n// normalize the \"sort\" value\nfunction massageSort(sort) {\n  if (!Array.isArray(sort)) {\n    throw new Error('invalid sort json - should be an array');\n  }\n  return sort.map(function (sorting) {\n    if (typeof sorting === 'string') {\n      var obj = {};\n      obj[sorting] = 'asc';\n      return obj;\n    } else {\n      return sorting;\n    }\n  });\n}\n\nfunction massageUseIndex(useIndex) {\n  var cleanedUseIndex = [];\n  if (typeof useIndex === 'string') {\n    cleanedUseIndex.push(useIndex);\n  } else {\n    cleanedUseIndex = useIndex;\n  }\n\n  return cleanedUseIndex.map(function (name) {\n    return name.replace('_design/', '');\n  });\n}\n\nfunction massageIndexDef(indexDef) {\n  indexDef.fields = indexDef.fields.map(function (field) {\n    if (typeof field === 'string') {\n      var obj = {};\n      obj[field] = 'asc';\n      return obj;\n    }\n    return field;\n  });\n  return indexDef;\n}\n\nfunction getKeyFromDoc(doc, index) {\n  var res = [];\n  for (var i = 0; i < index.def.fields.length; i++) {\n    var field = getKey(index.def.fields[i]);\n    res.push(doc[field]);\n  }\n  return res;\n}\n\n// have to do this manually because REASONS. I don't know why\n// CouchDB didn't implement inclusive_start\nfunction filterInclusiveStart(rows, targetValue, index) {\n  var indexFields = index.def.fields;\n  for (var i = 0, len = rows.length; i < len; i++) {\n    var row = rows[i];\n\n    // shave off any docs at the beginning that are <= the\n    // target value\n\n    var docKey = getKeyFromDoc(row.doc, index);\n    if (indexFields.length === 1) {\n      docKey = docKey[0]; // only one field, not multi-field\n    } else { // more than one field in index\n      // in the case where e.g. the user is searching {$gt: {a: 1}}\n      // but the index is [a, b], then we need to shorten the doc key\n      while (docKey.length > targetValue.length) {\n        docKey.pop();\n      }\n    }\n    //ABS as we just looking for values that don't match\n    if (Math.abs(collate(docKey, targetValue)) > 0) {\n      // no need to filter any further; we're past the key\n      break;\n    }\n  }\n  return i > 0 ? rows.slice(i) : rows;\n}\n\nfunction reverseOptions(opts) {\n  var newOpts = clone(opts);\n  delete newOpts.startkey;\n  delete newOpts.endkey;\n  delete newOpts.inclusive_start;\n  delete newOpts.inclusive_end;\n\n  if ('endkey' in opts) {\n    newOpts.startkey = opts.endkey;\n  }\n  if ('startkey' in opts) {\n    newOpts.endkey = opts.startkey;\n  }\n  if ('inclusive_start' in opts) {\n    newOpts.inclusive_end = opts.inclusive_start;\n  }\n  if ('inclusive_end' in opts) {\n    newOpts.inclusive_start = opts.inclusive_end;\n  }\n  return newOpts;\n}\n\nfunction validateIndex(index) {\n  var ascFields = index.fields.filter(function (field) {\n    return getValue(field) === 'asc';\n  });\n  if (ascFields.length !== 0 && ascFields.length !== index.fields.length) {\n    throw new Error('unsupported mixed sorting');\n  }\n}\n\nfunction validateSort(requestDef, index) {\n  if (index.defaultUsed && requestDef.sort) {\n    var noneIdSorts = requestDef.sort.filter(function (sortItem) {\n      return Object.keys(sortItem)[0] !== '_id';\n    }).map(function (sortItem) {\n      return Object.keys(sortItem)[0];\n    });\n\n    if (noneIdSorts.length > 0) {\n      throw new Error('Cannot sort on field(s) \"' + noneIdSorts.join(',') +\n      '\" when using the default index');\n    }\n  }\n\n  if (index.defaultUsed) {\n    return;\n  }\n}\n\nfunction validateFindRequest(requestDef) {\n  if (typeof requestDef.selector !== 'object') {\n    throw new Error('you must provide a selector when you find()');\n  }\n\n  /*var selectors = requestDef.selector['$and'] || [requestDef.selector];\n  for (var i = 0; i < selectors.length; i++) {\n    var selector = selectors[i];\n    var keys = Object.keys(selector);\n    if (keys.length === 0) {\n      throw new Error('invalid empty selector');\n    }\n    //var selection = selector[keys[0]];\n    /*if (Object.keys(selection).length !== 1) {\n      throw new Error('invalid selector: ' + JSON.stringify(selection) +\n        ' - it must have exactly one key/value');\n    }\n  }*/\n}\n\n// determine the maximum number of fields\n// we're going to need to query, e.g. if the user\n// has selection ['a'] and sorting ['a', 'b'], then we\n// need to use the longer of the two: ['a', 'b']\nfunction getUserFields(selector, sort) {\n  var selectorFields = Object.keys(selector);\n  var sortFields = sort? sort.map(getKey) : [];\n  var userFields;\n  if (selectorFields.length >= sortFields.length) {\n    userFields = selectorFields;\n  } else {\n    userFields = sortFields;\n  }\n\n  if (sortFields.length === 0) {\n    return {\n      fields: userFields\n    };\n  }\n\n  // sort according to the user's preferred sorting\n  userFields = userFields.sort(function (left, right) {\n    var leftIdx = sortFields.indexOf(left);\n    if (leftIdx === -1) {\n      leftIdx = Number.MAX_VALUE;\n    }\n    var rightIdx = sortFields.indexOf(right);\n    if (rightIdx === -1) {\n      rightIdx = Number.MAX_VALUE;\n    }\n    return leftIdx < rightIdx ? -1 : leftIdx > rightIdx ? 1 : 0;\n  });\n\n  return {\n    fields: userFields,\n    sortOrder: sort.map(getKey)\n  };\n}\n\nfunction createIndex$1(db, requestDef) {\n  requestDef = massageCreateIndexRequest(requestDef);\n  var originalIndexDef = clone(requestDef.index);\n  requestDef.index = massageIndexDef(requestDef.index);\n\n  validateIndex(requestDef.index);\n\n  // calculating md5 is expensive - memoize and only\n  // run if required\n  var md5;\n  function getMd5() {\n    return md5 || (md5 = stringMd5(JSON.stringify(requestDef)));\n  }\n\n  var viewName = requestDef.name || ('idx-' + getMd5());\n\n  var ddocName = requestDef.ddoc || ('idx-' + getMd5());\n  var ddocId = '_design/' + ddocName;\n\n  var hasInvalidLanguage = false;\n  var viewExists = false;\n\n  function updateDdoc(doc) {\n    if (doc._rev && doc.language !== 'query') {\n      hasInvalidLanguage = true;\n    }\n    doc.language = 'query';\n    doc.views = doc.views || {};\n\n    viewExists = !!doc.views[viewName];\n\n    if (viewExists) {\n      return false;\n    }\n\n    doc.views[viewName] = {\n      map: {\n        fields: mergeObjects(requestDef.index.fields)\n      },\n      reduce: '_count',\n      options: {\n        def: originalIndexDef\n      }\n    };\n\n    return doc;\n  }\n\n  db.constructor.emit('debug', ['find', 'creating index', ddocId]);\n\n  return upsert(db, ddocId, updateDdoc).then(function () {\n    if (hasInvalidLanguage) {\n      throw new Error('invalid language for ddoc with id \"' +\n      ddocId +\n      '\" (should be \"query\")');\n    }\n  }).then(function () {\n    // kick off a build\n    // TODO: abstract-pouchdb-mapreduce should support auto-updating\n    // TODO: should also use update_after, but pouchdb/pouchdb#3415 blocks me\n    var signature = ddocName + '/' + viewName;\n    return abstractMapper$1(db).query.call(db, signature, {\n      limit: 0,\n      reduce: false\n    }).then(function () {\n      return {\n        id: ddocId,\n        name: viewName,\n        result: viewExists ? 'exists' : 'created'\n      };\n    });\n  });\n}\n\nfunction getIndexes$1(db) {\n  // just search through all the design docs and filter in-memory.\n  // hopefully there aren't that many ddocs.\n  return db.allDocs({\n    startkey: '_design/',\n    endkey: '_design/\\uffff',\n    include_docs: true\n  }).then(function (allDocsRes) {\n    var res = {\n      indexes: [{\n        ddoc: null,\n        name: '_all_docs',\n        type: 'special',\n        def: {\n          fields: [{_id: 'asc'}]\n        }\n      }]\n    };\n\n    res.indexes = flatten(res.indexes, allDocsRes.rows.filter(function (row) {\n      return row.doc.language === 'query';\n    }).map(function (row) {\n      var viewNames = row.doc.views !== undefined ? Object.keys(row.doc.views) : [];\n\n      return viewNames.map(function (viewName) {\n        var view = row.doc.views[viewName];\n        return {\n          ddoc: row.id,\n          name: viewName,\n          type: 'json',\n          def: massageIndexDef(view.options.def)\n        };\n      });\n    }));\n\n    // these are sorted by view name for some reason\n    res.indexes.sort(function (left, right) {\n      return compare(left.name, right.name);\n    });\n    res.total_rows = res.indexes.length;\n    return res;\n  });\n}\n\n// couchdb lowest collation value\nvar COLLATE_LO = null;\n\n// couchdb highest collation value (TODO: well not really, but close enough amirite)\nvar COLLATE_HI = {\"\\uffff\": {}};\n\n// couchdb second-lowest collation value\n\nfunction checkFieldInIndex(index, field) {\n  var indexFields = index.def.fields.map(getKey);\n  for (var i = 0, len = indexFields.length; i < len; i++) {\n    var indexField = indexFields[i];\n    if (field === indexField) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// so when you do e.g. $eq/$eq, we can do it entirely in the database.\n// but when you do e.g. $gt/$eq, the first part can be done\n// in the database, but the second part has to be done in-memory,\n// because $gt has forced us to lose precision.\n// so that's what this determines\nfunction userOperatorLosesPrecision(selector, field) {\n  var matcher = selector[field];\n  var userOperator = getKey(matcher);\n\n  return userOperator !== '$eq';\n}\n\n// sort the user fields by their position in the index,\n// if they're in the index\nfunction sortFieldsByIndex(userFields, index) {\n  var indexFields = index.def.fields.map(getKey);\n\n  return userFields.slice().sort(function (a, b) {\n    var aIdx = indexFields.indexOf(a);\n    var bIdx = indexFields.indexOf(b);\n    if (aIdx === -1) {\n      aIdx = Number.MAX_VALUE;\n    }\n    if (bIdx === -1) {\n      bIdx = Number.MAX_VALUE;\n    }\n    return compare(aIdx, bIdx);\n  });\n}\n\n// first pass to try to find fields that will need to be sorted in-memory\nfunction getBasicInMemoryFields(index, selector, userFields) {\n\n  userFields = sortFieldsByIndex(userFields, index);\n\n  // check if any of the user selectors lose precision\n  var needToFilterInMemory = false;\n  for (var i = 0, len = userFields.length; i < len; i++) {\n    var field = userFields[i];\n    if (needToFilterInMemory || !checkFieldInIndex(index, field)) {\n      return userFields.slice(i);\n    }\n    if (i < len - 1 && userOperatorLosesPrecision(selector, field)) {\n      needToFilterInMemory = true;\n    }\n  }\n  return [];\n}\n\nfunction getInMemoryFieldsFromNe(selector) {\n  var fields = [];\n  Object.keys(selector).forEach(function (field) {\n    var matcher = selector[field];\n    Object.keys(matcher).forEach(function (operator) {\n      if (operator === '$ne') {\n        fields.push(field);\n      }\n    });\n  });\n  return fields;\n}\n\nfunction getInMemoryFields(coreInMemoryFields, index, selector, userFields) {\n  var result = flatten(\n    // in-memory fields reported as necessary by the query planner\n    coreInMemoryFields,\n    // combine with another pass that checks for any we may have missed\n    getBasicInMemoryFields(index, selector, userFields),\n    // combine with another pass that checks for $ne's\n    getInMemoryFieldsFromNe(selector)\n  );\n\n  return sortFieldsByIndex(uniq(result), index);\n}\n\n// check that at least one field in the user's query is represented\n// in the index. order matters in the case of sorts\nfunction checkIndexFieldsMatch(indexFields, sortOrder, fields) {\n  if (sortOrder) {\n    // array has to be a strict subarray of index array. furthermore,\n    // the sortOrder fields need to all be represented in the index\n    var sortMatches = oneArrayIsStrictSubArrayOfOther(sortOrder, indexFields);\n    var selectorMatches = oneArrayIsSubArrayOfOther(fields, indexFields);\n\n    return sortMatches && selectorMatches;\n  }\n\n  // all of the user's specified fields still need to be\n  // on the left side of the index array, although the order\n  // doesn't matter\n  return oneSetIsSubArrayOfOther(fields, indexFields);\n}\n\nvar logicalMatchers = ['$eq', '$gt', '$gte', '$lt', '$lte'];\nfunction isNonLogicalMatcher(matcher) {\n  return logicalMatchers.indexOf(matcher) === -1;\n}\n\n// check all the index fields for usages of '$ne'\n// e.g. if the user queries {foo: {$ne: 'foo'}, bar: {$eq: 'bar'}},\n// then we can neither use an index on ['foo'] nor an index on\n// ['foo', 'bar'], but we can use an index on ['bar'] or ['bar', 'foo']\nfunction checkFieldsLogicallySound(indexFields, selector) {\n  var firstField = indexFields[0];\n  var matcher = selector[firstField];\n\n  if (typeof matcher === 'undefined') {\n    /* istanbul ignore next */\n    return true;\n  }\n\n  var isInvalidNe = Object.keys(matcher).length === 1 &&\n    getKey(matcher) === '$ne';\n\n  return !isInvalidNe;\n}\n\nfunction checkIndexMatches(index, sortOrder, fields, selector) {\n\n  var indexFields = index.def.fields.map(getKey);\n\n  var fieldsMatch = checkIndexFieldsMatch(indexFields, sortOrder, fields);\n\n  if (!fieldsMatch) {\n    return false;\n  }\n\n  return checkFieldsLogicallySound(indexFields, selector);\n}\n\n//\n// the algorithm is very simple:\n// take all the fields the user supplies, and if those fields\n// are a strict subset of the fields in some index,\n// then use that index\n//\n//\nfunction findMatchingIndexes(selector, userFields, sortOrder, indexes) {\n\n  return indexes.reduce(function (res, index) {\n    var indexMatches = checkIndexMatches(index, sortOrder, userFields, selector);\n    if (indexMatches) {\n      res.push(index);\n    }\n    return res;\n  }, []);\n}\n\n// find the best index, i.e. the one that matches the most fields\n// in the user's query\nfunction findBestMatchingIndex(selector, userFields, sortOrder, indexes, useIndex) {\n\n  var matchingIndexes = findMatchingIndexes(selector, userFields, sortOrder, indexes);\n\n  if (matchingIndexes.length === 0) {\n    if (useIndex) {\n      throw {\n        error: \"no_usable_index\",\n        message: \"There is no index available for this selector.\"\n      };\n    }\n    //return `all_docs` as a default index;\n    //I'm assuming that _all_docs is always first\n    var defaultIndex = indexes[0];\n    defaultIndex.defaultUsed = true;\n    return defaultIndex;\n  }\n  if (matchingIndexes.length === 1 && !useIndex) {\n    return matchingIndexes[0];\n  }\n\n  var userFieldsMap = arrayToObject(userFields);\n\n  function scoreIndex(index) {\n    var indexFields = index.def.fields.map(getKey);\n    var score = 0;\n    for (var i = 0, len = indexFields.length; i < len; i++) {\n      var indexField = indexFields[i];\n      if (userFieldsMap[indexField]) {\n        score++;\n      }\n    }\n    return score;\n  }\n\n  if (useIndex) {\n    var useIndexDdoc = '_design/' + useIndex[0];\n    var useIndexName = useIndex.length === 2 ? useIndex[1] : false;\n    var index = matchingIndexes.find(function (index) {\n      if (useIndexName && index.ddoc === useIndexDdoc && useIndexName === index.name) {\n        return true;\n      }\n\n      if (index.ddoc === useIndexDdoc) {\n        /* istanbul ignore next */\n        return true;\n      }\n\n      return false;\n    });\n\n    if (!index) {\n      throw {\n        error: \"unknown_error\",\n        message: \"Could not find that index or could not use that index for the query\"\n      };\n    }\n    return index;\n  }\n\n  return max(matchingIndexes, scoreIndex);\n}\n\nfunction getSingleFieldQueryOptsFor(userOperator, userValue) {\n  switch (userOperator) {\n    case '$eq':\n      return {key: userValue};\n    case '$lte':\n      return {endkey: userValue};\n    case '$gte':\n      return {startkey: userValue};\n    case '$lt':\n      return {\n        endkey: userValue,\n        inclusive_end: false\n      };\n    case '$gt':\n      return {\n        startkey: userValue,\n        inclusive_start: false\n      };\n  }\n\n  return {\n    startkey: COLLATE_LO\n  };\n}\n\nfunction getSingleFieldCoreQueryPlan(selector, index) {\n  var field = getKey(index.def.fields[0]);\n  //ignoring this because the test to exercise the branch is skipped at the moment\n  /* istanbul ignore next */\n  var matcher = selector[field] || {};\n  var inMemoryFields = [];\n\n  var userOperators = Object.keys(matcher);\n\n  var combinedOpts;\n\n  userOperators.forEach(function (userOperator) {\n\n    if (isNonLogicalMatcher(userOperator)) {\n      inMemoryFields.push(field);\n    }\n\n    var userValue = matcher[userOperator];\n\n    var newQueryOpts = getSingleFieldQueryOptsFor(userOperator, userValue);\n\n    if (combinedOpts) {\n      combinedOpts = mergeObjects([combinedOpts, newQueryOpts]);\n    } else {\n      combinedOpts = newQueryOpts;\n    }\n  });\n\n  return {\n    queryOpts: combinedOpts,\n    inMemoryFields: inMemoryFields\n  };\n}\n\nfunction getMultiFieldCoreQueryPlan(userOperator, userValue) {\n  switch (userOperator) {\n    case '$eq':\n      return {\n        startkey: userValue,\n        endkey: userValue\n      };\n    case '$lte':\n      return {\n        endkey: userValue\n      };\n    case '$gte':\n      return {\n        startkey: userValue\n      };\n    case '$lt':\n      return {\n        endkey: userValue,\n        inclusive_end: false\n      };\n    case '$gt':\n      return {\n        startkey: userValue,\n        inclusive_start: false\n      };\n  }\n}\n\nfunction getMultiFieldQueryOpts(selector, index) {\n\n  var indexFields = index.def.fields.map(getKey);\n\n  var inMemoryFields = [];\n  var startkey = [];\n  var endkey = [];\n  var inclusiveStart;\n  var inclusiveEnd;\n\n\n  function finish(i) {\n\n    if (inclusiveStart !== false) {\n      startkey.push(COLLATE_LO);\n    }\n    if (inclusiveEnd !== false) {\n      endkey.push(COLLATE_HI);\n    }\n    // keep track of the fields where we lost specificity,\n    // and therefore need to filter in-memory\n    inMemoryFields = indexFields.slice(i);\n  }\n\n  for (var i = 0, len = indexFields.length; i < len; i++) {\n    var indexField = indexFields[i];\n\n    var matcher = selector[indexField];\n\n    if (!matcher || !Object.keys(matcher).length) { // fewer fields in user query than in index\n      finish(i);\n      break;\n    } else if (i > 0) {\n      if (Object.keys(matcher).some(isNonLogicalMatcher)) { // non-logical are ignored\n        finish(i);\n        break;\n      }\n      var usingGtlt = (\n        '$gt' in matcher || '$gte' in matcher ||\n        '$lt' in matcher || '$lte' in matcher);\n      var previousKeys = Object.keys(selector[indexFields[i - 1]]);\n      var previousWasEq = arrayEquals(previousKeys, ['$eq']);\n      var previousWasSame = arrayEquals(previousKeys, Object.keys(matcher));\n      var gtltLostSpecificity = usingGtlt && !previousWasEq && !previousWasSame;\n      if (gtltLostSpecificity) {\n        finish(i);\n        break;\n      }\n    }\n\n    var userOperators = Object.keys(matcher);\n\n    var combinedOpts = null;\n\n    for (var j = 0; j < userOperators.length; j++) {\n      var userOperator = userOperators[j];\n      var userValue = matcher[userOperator];\n\n      var newOpts = getMultiFieldCoreQueryPlan(userOperator, userValue);\n\n      if (combinedOpts) {\n        combinedOpts = mergeObjects([combinedOpts, newOpts]);\n      } else {\n        combinedOpts = newOpts;\n      }\n    }\n\n    startkey.push('startkey' in combinedOpts ? combinedOpts.startkey : COLLATE_LO);\n    endkey.push('endkey' in combinedOpts ? combinedOpts.endkey : COLLATE_HI);\n    if ('inclusive_start' in combinedOpts) {\n      inclusiveStart = combinedOpts.inclusive_start;\n    }\n    if ('inclusive_end' in combinedOpts) {\n      inclusiveEnd = combinedOpts.inclusive_end;\n    }\n  }\n\n  var res = {\n    startkey: startkey,\n    endkey: endkey\n  };\n\n  if (typeof inclusiveStart !== 'undefined') {\n    res.inclusive_start = inclusiveStart;\n  }\n  if (typeof inclusiveEnd !== 'undefined') {\n    res.inclusive_end = inclusiveEnd;\n  }\n\n  return {\n    queryOpts: res,\n    inMemoryFields: inMemoryFields\n  };\n}\n\nfunction getDefaultQueryPlan(selector) {\n  //using default index, so all fields need to be done in memory\n  return {\n    queryOpts: {startkey: null},\n    inMemoryFields: [Object.keys(selector)]\n  };\n}\n\nfunction getCoreQueryPlan(selector, index) {\n  if (index.defaultUsed) {\n    return getDefaultQueryPlan(selector, index);\n  }\n\n  if (index.def.fields.length === 1) {\n    // one field in index, so the value was indexed as a singleton\n    return getSingleFieldCoreQueryPlan(selector, index);\n  }\n  // else index has multiple fields, so the value was indexed as an array\n  return getMultiFieldQueryOpts(selector, index);\n}\n\nfunction planQuery(request, indexes) {\n\n  var selector = request.selector;\n  var sort = request.sort;\n\n  var userFieldsRes = getUserFields(selector, sort);\n\n  var userFields = userFieldsRes.fields;\n  var sortOrder = userFieldsRes.sortOrder;\n  var index = findBestMatchingIndex(selector, userFields, sortOrder, indexes, request.use_index);\n\n  var coreQueryPlan = getCoreQueryPlan(selector, index);\n  var queryOpts = coreQueryPlan.queryOpts;\n  var coreInMemoryFields = coreQueryPlan.inMemoryFields;\n\n  var inMemoryFields = getInMemoryFields(coreInMemoryFields, index, selector, userFields);\n\n  var res = {\n    queryOpts: queryOpts,\n    index: index,\n    inMemoryFields: inMemoryFields\n  };\n  return res;\n}\n\nfunction indexToSignature(index) {\n  // remove '_design/'\n  return index.ddoc.substring(8) + '/' + index.name;\n}\n\nfunction doAllDocs(db, originalOpts) {\n  var opts = clone(originalOpts);\n\n  // CouchDB responds in weird ways when you provide a non-string to _id;\n  // we mimic the behavior for consistency. See issue66 tests for details.\n\n  if (opts.descending) {\n    if ('endkey' in opts && typeof opts.endkey !== 'string') {\n      opts.endkey = '';\n    }\n    if ('startkey' in opts && typeof opts.startkey !== 'string') {\n      opts.limit = 0;\n    }\n  } else {\n    if ('startkey' in opts && typeof opts.startkey !== 'string') {\n      opts.startkey = '';\n    }\n    if ('endkey' in opts && typeof opts.endkey !== 'string') {\n      opts.limit = 0;\n    }\n  }\n  if ('key' in opts && typeof opts.key !== 'string') {\n    opts.limit = 0;\n  }\n\n  return db.allDocs(opts)\n  .then(function (res) {\n    // filter out any design docs that _all_docs might return\n    res.rows = res.rows.filter(function (row) {\n      return !/^_design\\//.test(row.id);\n    });\n    return res;\n  });\n}\n\nfunction find$1(db, requestDef, explain) {\n  if (requestDef.selector) {\n    requestDef.selector = massageSelector(requestDef.selector);\n  }\n\n  if (requestDef.sort) {\n    requestDef.sort = massageSort(requestDef.sort);\n  }\n\n  if (requestDef.use_index) {\n    requestDef.use_index = massageUseIndex(requestDef.use_index);\n  }\n\n  validateFindRequest(requestDef);\n\n  return getIndexes$1(db).then(function (getIndexesRes) {\n\n    db.constructor.emit('debug', ['find', 'planning query', requestDef]);\n    var queryPlan = planQuery(requestDef, getIndexesRes.indexes);\n    db.constructor.emit('debug', ['find', 'query plan', queryPlan]);\n\n    var indexToUse = queryPlan.index;\n\n    validateSort(requestDef, indexToUse);\n\n    var opts = assign({\n      include_docs: true,\n      reduce: false\n    }, queryPlan.queryOpts);\n\n    if ('startkey' in opts && 'endkey' in opts &&\n        collate(opts.startkey, opts.endkey) > 0) {\n      // can't possibly return any results, startkey > endkey\n      /* istanbul ignore next */\n      return {docs: []};\n    }\n\n    var isDescending = requestDef.sort &&\n      typeof requestDef.sort[0] !== 'string' &&\n      getValue(requestDef.sort[0]) === 'desc';\n\n    if (isDescending) {\n      // either all descending or all ascending\n      opts.descending = true;\n      opts = reverseOptions(opts);\n    }\n\n    if (!queryPlan.inMemoryFields.length) {\n      // no in-memory filtering necessary, so we can let the\n      // database do the limit/skip for us\n      if ('limit' in requestDef) {\n        opts.limit = requestDef.limit;\n      }\n      if ('skip' in requestDef) {\n        opts.skip = requestDef.skip;\n      }\n    }\n\n    if (explain) {\n      return Promise.resolve(queryPlan, opts);\n    }\n\n    return Promise.resolve().then(function () {\n      if (indexToUse.name === '_all_docs') {\n        return doAllDocs(db, opts);\n      } else {\n        var signature = indexToSignature(indexToUse);\n        return abstractMapper$1(db).query.call(db, signature, opts);\n      }\n    }).then(function (res) {\n      if (opts.inclusive_start === false) {\n        // may have to manually filter the first one,\n        // since couchdb has no true inclusive_start option\n        res.rows = filterInclusiveStart(res.rows, opts.startkey, indexToUse);\n      }\n\n      if (queryPlan.inMemoryFields.length) {\n        // need to filter some stuff in-memory\n        res.rows = filterInMemoryFields(res.rows, requestDef, queryPlan.inMemoryFields);\n      }\n\n      var resp = {\n        docs: res.rows.map(function (row) {\n          var doc = row.doc;\n          if (requestDef.fields) {\n            return pick(doc, requestDef.fields);\n          }\n          return doc;\n        })\n      };\n\n      if (indexToUse.defaultUsed) {\n        resp.warning = 'no matching index found, create an index to optimize query time';\n      }\n\n      return resp;\n    });\n  });\n}\n\nfunction explain$1(db, requestDef) {\n  return find$1(db, requestDef, true)\n  .then(function (queryPlan) {\n    return {\n      dbname: db.name,\n      index: queryPlan.index,\n      selector: requestDef.selector,\n      range: {\n        start_key: queryPlan.queryOpts.startkey,\n        end_key: queryPlan.queryOpts.endkey,\n      },\n      opts: {\n        use_index: requestDef.use_index || [],\n        bookmark: \"nil\", //hardcoded to match CouchDB since its not supported,\n        limit: requestDef.limit,\n        skip: requestDef.skip,\n        sort: requestDef.sort || {},\n        fields: requestDef.fields,\n        conflicts: false, //hardcoded to match CouchDB since its not supported,\n        r: [49], // hardcoded to match CouchDB since its not support\n      },\n      limit: requestDef.limit,\n      skip: requestDef.skip || 0,\n      fields: requestDef.fields,\n    };\n  });\n}\n\nfunction deleteIndex$1(db, index) {\n\n  if (!index.ddoc) {\n    throw new Error('you must supply an index.ddoc when deleting');\n  }\n\n  if (!index.name) {\n    throw new Error('you must supply an index.name when deleting');\n  }\n\n  var docId = index.ddoc;\n  var viewName = index.name;\n\n  function deltaFun(doc) {\n    if (Object.keys(doc.views).length === 1 && doc.views[viewName]) {\n      // only one view in this ddoc, delete the whole ddoc\n      return {_id: docId, _deleted: true};\n    }\n    // more than one view here, just remove the view\n    delete doc.views[viewName];\n    return doc;\n  }\n\n  return upsert(db, docId, deltaFun).then(function () {\n    return abstractMapper$1(db).viewCleanup.apply(db);\n  }).then(function () {\n    return {ok: true};\n  });\n}\n\nvar createIndexAsCallback = callbackify(createIndex$1);\nvar findAsCallback = callbackify(find$1);\nvar explainAsCallback = callbackify(explain$1);\nvar getIndexesAsCallback = callbackify(getIndexes$1);\nvar deleteIndexAsCallback = callbackify(deleteIndex$1);\n\nvar plugin = {};\nplugin.createIndex = toPromise(function (requestDef, callback) {\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide an index to create'));\n  }\n\n  var createIndex$$1 = isRemote(this) ?\n    createIndex : createIndexAsCallback;\n  createIndex$$1(this, requestDef, callback);\n});\n\nplugin.find = toPromise(function (requestDef, callback) {\n\n  if (typeof callback === 'undefined') {\n    callback = requestDef;\n    requestDef = undefined;\n  }\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide search parameters to find()'));\n  }\n\n  var find$$1 = isRemote(this) ? find : findAsCallback;\n  find$$1(this, requestDef, callback);\n});\n\nplugin.explain = toPromise(function (requestDef, callback) {\n\n  if (typeof callback === 'undefined') {\n    callback = requestDef;\n    requestDef = undefined;\n  }\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide search parameters to explain()'));\n  }\n\n  var find$$1 = isRemote(this) ? explain : explainAsCallback;\n  find$$1(this, requestDef, callback);\n});\n\nplugin.getIndexes = toPromise(function (callback) {\n\n  var getIndexes$$1 = isRemote(this) ? getIndexes : getIndexesAsCallback;\n  getIndexes$$1(this, callback);\n});\n\nplugin.deleteIndex = toPromise(function (indexDef, callback) {\n\n  if (typeof indexDef !== 'object') {\n    return callback(new Error('you must provide an index to delete'));\n  }\n\n  var deleteIndex$$1 = isRemote(this) ?\n    deleteIndex : deleteIndexAsCallback;\n  deleteIndex$$1(this, indexDef, callback);\n});\n\nexport default plugin;\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","// document.currentScript polyfill by Adam Miller\n\n// MIT license\n\n(function(document){\n  var currentScript = \"currentScript\",\n      scripts = document.getElementsByTagName('script'); // Live NodeList collection\n\n  // If browser needs currentScript polyfill, add get currentScript() to the document object\n  if (!(currentScript in document)) {\n    Object.defineProperty(document, currentScript, {\n      get: function(){\n\n        // IE 6-10 supports script readyState\n        // IE 10+ support stack trace\n        try { throw new Error(); }\n        catch (err) {\n\n          // Find the second match for the \"at\" string to get file src url from stack.\n          // Specifically works with the format of stack traces in IE.\n          var i, res = ((/.*at [^\\(]*\\((.*):.+:.+\\)$/ig).exec(err.stack) || [false])[1];\n\n          // For all scripts on the page, if src matches or if ready state is interactive, return the script tag\n          for(i in scripts){\n            if(scripts[i].src == res || scripts[i].readyState == \"interactive\"){\n              return scripts[i];\n            }\n          }\n\n          // If no match, return null\n          return null;\n        }\n      }\n    });\n  }\n})(document);\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = $getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  var args = [];\n  for (var i = 0; i < arguments.length; i++) args.push(arguments[i]);\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    ReflectApply(this.listener, this.target, args);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","// This file is imported into lib/wc client bundles.\n\nif (typeof window !== 'undefined') {\n  if (process.env.NEED_CURRENTSCRIPT_POLYFILL) {\n    require('current-script-polyfill')\n  }\n\n  var i\n  if ((i = window.document.currentScript) && (i = i.src.match(/(.+\\/)[^/]+\\.js(\\?.*)?$/))) {\n    __webpack_public_path__ = i[1] // eslint-disable-line\n  }\n}\n\n// Indicate to webpack that this file can be concatenated\nexport default null\n","import PouchDB from 'pouchdb';\n\nPouchDB.plugin(require('pouchdb-find').default);\n\nexport function db(name, options) {\n    return new PouchDB(name, options);\n}\n\nconst global = db(process.env.VUE_APP_DB_NAME || 'capsule');\n\nexport function execute(method, key, ...args) {\n    if(Array.isArray(key)) {\n        const promises = key.map(key => method(key).then(data => {\n            return [key, data];\n        }, e => {\n            return [key, undefined];\n        }));\n\n        return Promise.all(promises).then(data => {\n            return data.reduce((carry, [key, data]) => {\n                return Object.assign({[key]: data }, carry);\n            }, {});\n        });\n    }\n    else {\n        return method(key, ...args);\n    }\n}\n\nexport function promise(data) {\n    if(data instanceof Promise) {\n        return data;\n    }\n\n    if(typeof data === 'function') {\n        return promise(data());\n    }\n\n    return Promise.resolve(data);\n}\n\nexport function id(doc) {\n    return doc && doc._id || doc;\n}\n\nexport function isJson(data) {\n    if(data instanceof Promise) {\n        return false;\n    }\n\n    try {\n        return typeof JSON.parse(JSON.stringify(data)) === 'object';\n    }\n    catch (e) {\n        return false;\n    }\n}\n\nexport function find(...args) {\n    return global.find(...args);\n}\n\nexport function findKey(key, ...args) {\n    return find({\n        selector: {\n            $or: [{\n                _id: key\n            }].concat([findCacheSelector(key)])\n        }\n    }, ...args);\n}\n\nexport function findFirstKey(key, ...args) {\n    return findKey(key, ...args).then(({ docs }) => docs.slice(0, 1).pop());\n}\n\nexport function firstOrFail(key, ...args) {\n    return new Promise((resolve, reject) => {\n        findFirstKey(key, ...args).then(doc => {\n            if(doc) {\n                resolve(doc);\n            }\n            else {\n                global.get(key, ...args).then(resolve, reject);\n            }\n        });\n    });\n}\n\nexport function findConfig(key, ...args) {\n    return get(key, ...args).then(({ data }) => data, () => undefined);\n}\n\nexport function findCache(key, ...args) {\n    return findConfig(key, ...args);\n}\n\nexport function config(key, data, ...args) {\n    if(typeof data === 'undefined') {\n        return execute(findConfig, key, ...args);\n    }\n    \n    return new Promise((resolve, reject) => {\n        promise(data).then(data => {\n            save(key, { data }).then(({ data }) => resolve(data), e => resolve());\n        });\n    });\n}\n\nexport function get(key, ...args) {\n    return execute(firstOrFail, key, ...args);\n}\n\nexport function post(doc, ...args) {\n    doc = JSON.parse(JSON.stringify(doc));\n\n    return new Promise((resolve, reject) => {\n        execute(global.post, doc, ...args).then(({ id }) => {\n            get(id).then(resolve, reject);\n        }, reject);\n    });\n}\n\nexport function put(doc, ...args) {\n    const { _id } = doc;\n    \n    doc = JSON.parse(JSON.stringify(doc));\n\n    return new Promise((resolve, reject) => {\n        find({ selector: { _id }}).then(({ docs }) => {\n            if(docs.length === 1) {\n                const { _rev } = docs.pop();\n\n                Object.assign(doc, { _rev });\n            }\n\n            execute(global.put, doc, ...args).then(({ id }) => {\n                get(id).then(resolve, reject);\n            }, reject);\n        });\n    });\n}\n\nexport function remove(key, ...args) {\n    if(typeof key === 'object') {\n        return execute(global.remove, key, ...args);\n    }\n\n    return new Promise((resolve, reject) => {\n        get(key).then(doc => {\n            remove(doc).then(resolve, reject);\n        }, () => resolve());\n    });\n}\n\nexport function save(doc, data, ...args) {\n    if(Array.isArray(doc)) {\n        return execute(save, doc, data, ...args);    \n    }\n\n    if(!Object.keys(data).length || !isJson(doc) && !isJson(data)) {\n        return config(doc, data, ...args);\n    }\n    \n    if(typeof doc === 'string') {\n        doc = Object.assign({_id: doc}, data);\n    }\n    \n    return !doc._id ? post(doc) : put(doc);\n}\n\nexport function findCacheSelector(key) {\n    return {\n        key,\n        $cache: { $exists: true },\n        $or: [{\n            $expiredAt: { $eq: null },\n        }, {\n            $expiredAt: { $gt: new Date().getTime() },\n        }]\n    };\n}\n\nexport function purge(key, ...args) {\n    return remove(key, ...args);\n}\n\nexport function clearExpiredAt(key) {\n    return new Promise((resolve, reject) => {\n        find({\n            selector: {\n                _id: key,\n                $or: [{\n                    $expiredAt: { $exists: false }\n                },{\n                    $and: [{\n                        $expiredAt: { $exists: true }\n                    }, {\n                        $expiredAt: { $type : 'number' }\n                    }, {\n                        $expiredAt: { $lte: new Date().getTime() }\n                    }]\n                }]\n            }\n        }).then(({ docs }) => {\n            Promise.all(docs.map(doc => remove(doc))).then(resolve, reject);\n        }, reject);\n    });\n}\n\nexport function cache(key, data, length = null) {\n    if(typeof key === 'undefined') {\n        throw Error('cache() requires passing at least one key.');\n    }\n\n    if(typeof data === 'undefined') {\n        return execute(findCache, key);\n    }\n\n    if(data === null) {\n        return execute(purge, key);\n    }\n    \n    return new Promise((resolve, reject) => {\n        const $expiredAt = typeof length === 'number' && new Date().getTime() + length * 1000 || null;\n\n        clearExpiredAt(key).then(() => {\n            get(key).then(({ data }) => resolve(data), () => {\n                promise(data).then(data => {\n                    save(key, {\n                        data,\n                        $expiredAt,\n                        $cache: true,\n                        $cachedAt: new Date().getTime()\n                    }).then(({ data }) => resolve(data), reject);\n                }, reject);\n            });\n        }, reject);\n    });\n}\n\nexport default global;","import deepExtend from 'deep-extend';\nimport { get, save, config } from './Storage';\n\nfunction value(val, ...args) {\n    return typeof val === 'function' ? val(...args) : val;\n}\n\nfunction promise(val, ...args) {\n    val = value(val, ...args);\n\n    if(val instanceof Promise) {\n        return val;\n    }\n\n    return Promise.resolve(val);\n}\n\n// TODO: Create a file for an encryption when app first launches...\nexport default options => {\n    const key = options.key || 'config';\n\n    const DEFAULT_DRIVER = vuex => ({\n        initialize() {\n            promise(this.state).then(state => {\n                save(key, deepExtend(vuex.state, state)).then(state => {\n                    vuex.watch(this.watch, this.set, {\n                        deep: true\n                    });\n        \n                    vuex.replaceState(state);\n                });\n            });\n        },\n        watch(state) {\n            return state;\n        },\n        set(value) {\n            save(key, value);\n        },\n        state() {\n            return get(key).then(null, e => {\n                return null;\n            });\n        },\n        resetStateToDefault() {\n            console.log('reset');\n        }\n    });\n    \n    return vuex => {\n        const driver = Object.assign(\n            value(DEFAULT_DRIVER, vuex), value(options.driver, vuex)\n        );\n\n        driver.initialize();\n    };\n};\n","import './setPublicPath'\nexport * from '~entry'\n"],"sourceRoot":""}